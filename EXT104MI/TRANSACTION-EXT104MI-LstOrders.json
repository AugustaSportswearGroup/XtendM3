{"programModules":{"EXT104MI":{"program":"EXT104MI","triggers":{},"transactions":{"LstOrders":{"sourceUuid":"4f4a3498-617f-47a3-b346-b03974983e83","name":"LstOrders","program":"EXT104MI","description":"List Customer Orders","active":true,"multi":true,"modified":1698242594158,"modifiedBy":"SADANGJ","outputFields":[{"name":"DIVI","description":"Division","length":3,"mandatory":false,"type":"A"},{"name":"ORNO","description":"Order number","length":10,"mandatory":false,"type":"A"},{"name":"OREF","description":"Ecommerce order number","length":30,"mandatory":false,"type":"A"},{"name":"ORDT","description":"Order date","length":8,"mandatory":false,"type":"A"},{"name":"ORST","description":"Status","length":30,"mandatory":false,"type":"A"},{"name":"CUOR","description":"PO number","length":20,"mandatory":false,"type":"A"},{"name":"DSDT","description":"Ship date","length":8,"mandatory":false,"type":"A"},{"name":"ETRN","description":"Tracking number","length":200,"mandatory":false,"type":"A"},{"name":"CARR","description":"Carrier","length":15,"mandatory":false,"type":"A"},{"name":"NTLA","description":"Total order value net","length":16,"mandatory":false,"type":"A"},{"name":"MODL","description":"Delivery method","length":3,"mandatory":false,"type":"A"},{"name":"SUBL","description":"Sublimation","length":1,"mandatory":false,"type":"A"},{"name":"ORTP","description":"Order type","length":30,"mandatory":false,"type":"A"},{"name":"OBLC","description":"Order stop","length":3,"mandatory":false,"type":"A"},{"name":"CUCD","description":"Currency","length":3,"mandatory":false,"type":"A"},{"name":"STOT","description":"Shipping Total","length":16,"mandatory":false,"type":"A"},{"name":"DTOT","description":"Discount Total","length":16,"mandatory":false,"type":"A"},{"name":"ORSL","description":"Lowest status","length":2,"mandatory":false,"type":"A"},{"name":"ORSH","description":"Highest status","length":2,"mandatory":false,"type":"A"},{"name":"OTIP","description":"Tip number","length":10,"mandatory":false,"type":"A"}],"inputFields":[{"name":"DIVI","description":"Division","length":3,"mandatory":false,"type":"A"},{"name":"CUNO","description":"Customer number","length":10,"mandatory":true,"type":"A"},{"name":"ORNO","description":"Order number","length":10,"mandatory":false,"type":"A"},{"name":"PONO","description":"PO number","length":30,"mandatory":false,"type":"A"},{"name":"ITNO","description":"Item number","length":15,"mandatory":false,"type":"A"},{"name":"FRDT","description":"From Date","length":8,"mandatory":false,"type":"A"},{"name":"TODT","description":"To Date","length":8,"mandatory":false,"type":"A"},{"name":"PNUM","description":"Page number","length":3,"mandatory":false,"type":"A"},{"name":"PSZE","description":"Page size","length":3,"mandatory":false,"type":"A"},{"name":"LORN","description":"Last order number","length":10,"mandatory":false,"type":"A"},{"name":"DRTN","description":"Duration","length":4,"mandatory":false,"type":"A"},{"name":"LODT","description":"Last Order Date","length":8,"mandatory":false,"type":"A"},{"name":"OREF","description":"Order Reference number","length":30,"mandatory":false,"type":"A"},{"name":"ORTP","description":"Order type","length":30,"mandatory":false,"type":"A"},{"name":"IVNO","description":"Invoice number","length":14,"mandatory":false,"type":"A"},{"name":"STAT","description":"Status","length":30,"mandatory":false,"type":"A"}],"utilities":[]}},"batches":{},"advancedPrograms":{}}},"utilities":{},"sources":{"4f4a3498-617f-47a3-b346-b03974983e83":{"uuid":"4f4a3498-617f-47a3-b346-b03974983e83","updated":1711993426224,"updatedBy":"ABHISHEK","created":1698087907674,"createdBy":"SADANGJ","apiVersion":"0.21","beVersion":"16.0.0.20240116163623.6","language":"GROOVY","codeHash":"FE11F3DECB3B3971839BA2A14642FE5E31BECF6266422A8573B1C19EE87DCC48","code":"LyoqDQogKiBSRUFETUUNCiAqIFRoaXMgZXh0ZW5zaW9uIGlzIGJlaW5nIHVzZWQgdG8gbGlzdCBjdXN0b21lciBvcmRlcnMgZm9yIGVjb21tZXJjZSBCMkIgc2l0ZQ0KICoNCiAqIE5hbWU6IEVYVDEwNE1JLkxzdE9yZGVycw0KICogRGVzY3JpcHRpb246IFRyYW5zYWN0aW9uIHVzZWQgdG8gbGlzdCBjdXN0b21lciBvcmRlcnMgZm9yIGVjb21tZXJjZSBCMkIgc2l0ZQ0KICogRGF0ZQkgICAgICBDaGFuZ2VkIEJ5ICAgICAgICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uDQogKjIwMjMxMDIzICBTdXJpeWFOQGZvcnR1ZGUuY28gICAgIExpc3QgY3VzdG9tZXIgb3JkZXJzIGZvciBlY29tbWVyY2UgQjJCIHNpdGUqLw0KIA0KDQoNCnB1YmxpYyBjbGFzcyBMc3RPcmRlcnMgZXh0ZW5kcyBFeHRlbmRNM1RyYW5zYWN0aW9uIHsNCiAgcHJpdmF0ZSBmaW5hbCBNSUFQSSBtaQ0KICBwcml2YXRlIGZpbmFsIExvZ2dlckFQSSBsb2dnZXINCiAgcHJpdmF0ZSBmaW5hbCBQcm9ncmFtQVBJIHByb2dyYW0NCiAgcHJpdmF0ZSBmaW5hbCBEYXRhYmFzZUFQSSBkYXRhYmFzZQ0KICBwcml2YXRlIGZpbmFsIE1JQ2FsbGVyQVBJIG1pQ2FsbGVyDQogIHByaXZhdGUgaW50IGlDT05PLCByb3dDb3VudCwgbWF4UGFnZVNpemUgPSAxMDAwMA0KICBwcml2YXRlIGludCBwYWdlU2l6ZSwgcGFnZVJlY29yZENvdW50ID0gMCwgdHJhbnNsYXRpb25JZCA9IDAsIHBhZ2VSZWNvcmRNYXggPSAwDQogIHByaXZhdGUgU3RyaW5nIGlESVZJLCBpQ1VOTywgaU9STk8sIGlQT05PLCBpSVROTywgaUZSRFQsIGlUT0RULCBpUE5VTSwgaVBTWkUsIGlMT1JOLCBpRFJUTiwgaUxPRFQsIGlPUkVGLCBpT1JUUCwgaUlWTk8sIGlTVEFUDQogIHByaXZhdGUgYm9vbGVhbiB2YWxpZElucHV0ID0gdHJ1ZSwgaGFzT3JkZXJGaWx0ZXIgPSBmYWxzZQ0KICBwcml2YXRlIFN0cmluZyBvcmRlcnNGaWx0ZXIsIHpTdGF0dXMNCiAgcHJpdmF0ZSBNYXAgPCBTdHJpbmcsIEhhc2hNYXAgPiBwYWdlT3JkZXJzID0gbmV3IFRyZWVNYXAgPCBTdHJpbmcsIEhhc2hNYXAgPiAoQ29sbGVjdGlvbnMucmV2ZXJzZU9yZGVyKCkpDQogIHByaXZhdGUgbG9uZyB0aW1lc3RhbXAgPSAwTA0KICBwcml2YXRlIGRvdWJsZSBmcnQsIGNocmcsIHRheENoYXJnZQ0KDQogIHB1YmxpYyBMc3RPcmRlcnMoTUlBUEkgbWksIFByb2dyYW1BUEkgcHJvZ3JhbSwgRGF0YWJhc2VBUEkgZGF0YWJhc2UsIE1JQ2FsbGVyQVBJIG1pQ2FsbGVyLCBMb2dnZXJBUEkgbG9nZ2VyKSB7DQogICAgdGhpcy5taSA9IG1pDQogICAgdGhpcy5wcm9ncmFtID0gcHJvZ3JhbQ0KICAgIHRoaXMuZGF0YWJhc2UgPSBkYXRhYmFzZQ0KICAgIHRoaXMubWlDYWxsZXIgPSBtaUNhbGxlcg0KICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyDQogIH0NCg0KICAvKioNCiAgICogTWFpbiBtZXRob2QgdG8gcHJvY2VzcyBvcmRlcnMuDQogICAqLw0KDQogIHB1YmxpYyB2b2lkIG1haW4oKSB7DQogICAgaUNPTk8gPSBwcm9ncmFtLkxEQVpELkNPTk8gYXMgSW50ZWdlcg0KICAgIGlESVZJID0gKG1pLmluRGF0YS5nZXQoIkRJVkkiKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIkRJVkkiKS50cmltKCkuaXNFbXB0eSgpKSA/IHByb2dyYW0uTERBWkQuRElWSSBhcyBTdHJpbmcgOiBtaS5pbkRhdGEuZ2V0KCJESVZJIikgYXMgU3RyaW5nDQogICAgaUNVTk8gPSAobWkuaW5EYXRhLmdldCgiQ1VOTyIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiQ1VOTyIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJDVU5PIikudHJpbSgpDQogICAgaU9STk8gPSAobWkuaW5EYXRhLmdldCgiT1JOTyIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiT1JOTyIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJPUk5PIikudHJpbSgpDQogICAgaVBPTk8gPSAobWkuaW5EYXRhLmdldCgiUE9OTyIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiUE9OTyIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJQT05PIikudHJpbSgpDQogICAgaUlUTk8gPSAobWkuaW5EYXRhLmdldCgiSVROTyIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiSVROTyIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJJVE5PIikudHJpbSgpDQogICAgaUZSRFQgPSAobWkuaW5EYXRhLmdldCgiRlJEVCIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiRlJEVCIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJGUkRUIikudHJpbSgpDQogICAgaVRPRFQgPSAobWkuaW5EYXRhLmdldCgiVE9EVCIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiVE9EVCIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJUT0RUIikudHJpbSgpDQogICAgaVBOVU0gPSAobWkuaW5EYXRhLmdldCgiUE5VTSIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiUE5VTSIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIjEiIDogbWkuaW5EYXRhLmdldCgiUE5VTSIpLnRyaW0oKQ0KICAgIGlQU1pFID0gKG1pLmluRGF0YS5nZXQoIlBTWkUiKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIlBTWkUiKS50cmltKCkuaXNFbXB0eSgpKSA/ICIyNSIgOiBtaS5pbkRhdGEuZ2V0KCJQU1pFIikudHJpbSgpDQogICAgaUxPUk4gPSAobWkuaW5EYXRhLmdldCgiTE9STiIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiTE9STiIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJMT1JOIikudHJpbSgpDQogICAgaURSVE4gPSAobWkuaW5EYXRhLmdldCgiRFJUTiIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiRFJUTiIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJEUlROIikudHJpbSgpDQogICAgaUxPRFQgPSAobWkuaW5EYXRhLmdldCgiTE9EVCIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiTE9EVCIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJMT0RUIikudHJpbSgpLnRyaW0oKQ0KICAgIGlPUkVGID0gKG1pLmluRGF0YS5nZXQoIk9SRUYiKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIk9SRUYiKS50cmltKCkuaXNFbXB0eSgpKSA/ICIiIDogbWkuaW5EYXRhLmdldCgiT1JFRiIpLnRyaW0oKQ0KICAgIGlPUlRQID0gKG1pLmluRGF0YS5nZXQoIk9SVFAiKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIk9SVFAiKS50cmltKCkuaXNFbXB0eSgpKSA/ICIiIDogbWkuaW5EYXRhLmdldCgiT1JUUCIpLnRyaW0oKQ0KICAgIGlJVk5PID0gKG1pLmluRGF0YS5nZXQoIklWTk8iKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIklWTk8iKS50cmltKCkuaXNFbXB0eSgpKSA/ICIiIDogbWkuaW5EYXRhLmdldCgiSVZOTyIpLnRyaW0oKQ0KICAgIGlTVEFUID0gKG1pLmluRGF0YS5nZXQoIlNUQVQiKSA9PSBudWxsIHx8IG1pLmluRGF0YS5nZXQoIlNUQVQiKS50cmltKCkuaXNFbXB0eSgpKSA/ICIiIDogbWkuaW5EYXRhLmdldCgiU1RBVCIpLnRyaW0oKQ0KDQogICAgcGFnZVNpemUgPSBpUFNaRSBhcyBJbnRlZ2VyDQogICAgcmVhZE9yZGVycygpDQogICAgaW50IHBhZ2VOdW0gPSBpUE5VTSBhcyBJbnRlZ2VyDQogICAgaW50IHJlY29yZENvdW50ID0gMA0KICAgIGludCBwYWdlVG8gPSBwYWdlTnVtICogcGFnZVNpemUNCiAgICBpbnQgcGFnZUZyb20gPSAocGFnZVRvIC0gcGFnZVNpemUpICsgMQ0KICAgIGZvciAoTWFwLkVudHJ5IDwgU3RyaW5nLCBIYXNoTWFwID4gZW50cnk6IHBhZ2VPcmRlcnMuZW50cnlTZXQoKSkgew0KICAgICAgcmVjb3JkQ291bnQgPSByZWNvcmRDb3VudCArIDENCiAgICAgIGlmIChyZWNvcmRDb3VudCA+PSBwYWdlRnJvbSAmJiByZWNvcmRDb3VudCA8PSBwYWdlVG8pIHsNCiAgICAgICAgSGFzaE1hcCA8IFN0cmluZywgU3RyaW5nID4gb3JkZXIgPSAoSGFzaE1hcCkgZW50cnkuZ2V0VmFsdWUoKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiRElWSSIsIG9yZGVyLmdldCgiRElWSSIpLnRvU3RyaW5nKCkpDQogICAgICAgIFN0cmluZyBvcm5vID0gb3JkZXIuZ2V0KCJPUk5PIikudG9TdHJpbmcoKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiT1JOTyIsIG9ybm8pDQogICAgICAgIG1pLm91dERhdGEucHV0KCJPUkRUIiwgb3JkZXIuZ2V0KCJSR0RUIikudG9TdHJpbmcoKSkNCiAgICAgICAgU3RyaW5nIG9ydHAgPSBnZXRUcmFuc2xhdGlvbigiRUNaT1QiICsgb3JkZXIuZ2V0KCJPUlRQIikudG9TdHJpbmcoKSkNCiAgICAgICAgaWYgKG9ydHAuaXNFbXB0eSgpKSB7DQogICAgICAgICAgb3J0cCA9IGdldFRyYW5zbGF0aW9uKCJFQ1pPVERFRkFVIikNCiAgICAgICAgfQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiT1JUUCIsIG9ydHAgYXMgU3RyaW5nKQ0KICAgICAgICBTdHJpbmcgc3VibCA9IGdldFRyYW5zbGF0aW9uKCJTVUJMIiArIG9yZGVyLmdldCgiT1JUUCIpLnRvU3RyaW5nKCkpDQogICAgICAgIGlmIChzdWJsLmVxdWFscygiWSIpKSB7DQogICAgICAgICAgbWkub3V0RGF0YS5wdXQoIlNVQkwiLCAiMSIpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWkub3V0RGF0YS5wdXQoIlNVQkwiLCAiMCIpDQogICAgICAgIH0NCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIkNVQ0QiLCBvcmRlci5nZXQoIkNVQ0QiKS50b1N0cmluZygpKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiT1JFRiIsIG9yZGVyLmdldCgiT1JFRiIpLnRvU3RyaW5nKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJDVU9SIiwgb3JkZXIuZ2V0KCJDVU9SIikudG9TdHJpbmcoKSkNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIk9SU0wiLCBvcmRlci5nZXQoIk9SU0wiKS50b1N0cmluZygpKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiT1JTSCIsIG9yZGVyLmdldCgiT1JTVCIpLnRvU3RyaW5nKCkpDQogICAgICAgIHpTdGF0dXMgPSBnZXRPcmRlclN0YXR1cyhvcmRlci5nZXQoIk9SU0wiKSBhcyBJbnRlZ2VyLCBvcmRlci5nZXQoIk9SU1QiKSBhcyBJbnRlZ2VyKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiT1JTVCIsIHpTdGF0dXMpDQogICAgICAgIGludCBvYmxjID0gb3JkZXIuZ2V0KCJPQkxDIikgYXMgSW50ZWdlcg0KICAgICAgICBpZiAob2JsYyA+IDAgJiYgb2JsYyA8IDkpIHsNCiAgICAgICAgICBpZiAob2JsYyA9PSA3KSB7DQogICAgICAgICAgICBtaS5vdXREYXRhLnB1dCgiT0JMQyIsIG9yZGVyLmdldCgiT0JMQyIpLnRvU3RyaW5nKCkgKyAiLiIgKyBvcmRlci5nZXQoIkRUSUQiKS50b1N0cmluZygpKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBtaS5vdXREYXRhLnB1dCgiT0JMQyIsIG9yZGVyLmdldCgiT0JMQyIpLnRvU3RyaW5nKCkpDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIG1pLm91dERhdGEucHV0KCJPVElQIiwgZ2V0VGlwTnVtYmVyKG9ybm8pKQ0KICAgICAgICBTdHJpbmcgY3VubyA9IG9yZGVyLmdldCgiQ1VOTyIpLnRvU3RyaW5nKCkNCiAgICAgICAgSGFzaE1hcCA8IFN0cmluZywgU3RyaW5nID4gZGVsaXZlcnkgPSByZWFkRGVsaXZlcmllcyhjdW5vLCBvcm5vLCBvcmRlci5nZXQoIlRFUFkiKS50b1N0cmluZygpLCB6U3RhdHVzKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiQ0FSUiIsIGRlbGl2ZXJ5LmdldCgiQ0FSUiIpLnRvU3RyaW5nKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJNT0RMIiwgZGVsaXZlcnkuZ2V0KCJNT0RMIikudG9TdHJpbmcoKSkNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIkVUUk4iLCBkZWxpdmVyeS5nZXQoIkVUUk4iKS50b1N0cmluZygpKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiRFNEVCIsIGRlbGl2ZXJ5LmdldCgiRFNEVCIpLnRvU3RyaW5nKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJOVExBIiwgb3JkZXIuZ2V0KCJOVExBIikudG9TdHJpbmcoKSkNCiAgICAgICAgZG91YmxlIG50bGEgPSBvcmRlci5nZXQoIk5UTEEiKSBhcyBEb3VibGUNCiAgICAgICAgcnR2U2hpcHBpbmdDaGFyZ2VzKG9ybm8pDQogICAgICAgIG1pLm91dERhdGEucHV0KCJTVE9UIiwgZnJ0IGFzIFN0cmluZykNCiAgICAgICAgZG91YmxlIGRpc2NvdW50ID0gcnR2RGlzY291bnQob3JkZXIuT1JOTykNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIkRUT1QiLCBkaXNjb3VudCBhcyBTdHJpbmcpDQogICAgICAgIGRvdWJsZSB4YXZ0YW0gPSBydHZWYXRBbW91bnQob3JkZXIuT1JOTykNCiAgICAgICAgbnRsYSA9IG50bGEgKyBmcnQgKyBjaHJnICsgZGlzY291bnQgKyB0YXhDaGFyZ2UgKyB4YXZ0YW0NCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIk5UTEEiLCBudGxhIGFzIFN0cmluZykNCiAgICAgICAgbWkud3JpdGUoKQ0KICAgICAgfQ0KICAgICAgaWYgKHJlY29yZENvdW50ID49IHBhZ2VUbykgew0KICAgICAgICBicmVhaw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBWYWxpZGF0ZXMgaW5wdXQgZGF0YS4NCiAgICovDQoNCiAgcHVibGljIHZhbGlkYXRlSW5wdXQoKSB7DQogICAgaWYgKCFpQ1VOTy50cmltKCkuaXNFbXB0eSgpKSB7DQogICAgICAvL1ZhbGlkYXRlIEN1c3RvbWVyIE51bWJlcg0KICAgICAgTWFwIDwgU3RyaW5nLCBTdHJpbmcgPiBwYXJhbXMgPSBbIkNPTk8iOiBpQ09OTy50b1N0cmluZygpLnRyaW0oKSwgIkNVTk8iOiBpQ1VOTy50b1N0cmluZygpLnRyaW0oKV0NCiAgICAgIENsb3N1cmUgPCA/ID4gY2FsbGJhY2sgPSB7DQogICAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgICAgaWYgKHJlc3BvbnNlLkNVTk8gPT0gbnVsbCkgew0KICAgICAgICAgIG1pLmVycm9yKCJJbnZhbGlkIEN1c3RvbWVyIE51bWJlciAiICsgaUNVTk8pDQogICAgICAgICAgdmFsaWRJbnB1dCA9IGZhbHNlDQogICAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIG1pQ2FsbGVyLmNhbGwoIkNSUzYxME1JIiwgIkdldEJhc2ljRGF0YSIsIHBhcmFtcywgY2FsbGJhY2spDQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIFJlYWRzIG9yZGVycyB3aXRoIGZpbHRlciBiYXNlZCBvbiBjdXN0b21lciBudW1iZXJzLg0KICAgKiBAcGFyYW0gY3VzdG9tZXJzIEFuIGFycmF5IG9mIGN1c3RvbWVyIG51bWJlcnMNCiAgICogQHJldHVybiBUcnVlIGlmIHRoZXJlIGlzIGEgZmlsdGVyIG9uIG9yZGVycywgb3RoZXJ3aXNlIGZhbHNlDQogICAqLw0KDQogIHB1YmxpYyBib29sZWFuIHJlYWRPcmRlcnNXaXRoRmlsdGVyKFN0cmluZ1tdIGN1c3RvbWVycykgew0KICAgIGhhc09yZGVyRmlsdGVyID0gZmFsc2UNCiAgICBvcmRlcnNGaWx0ZXIgPSAiIg0KICAgIGlmICghaU9STk8uaXNFbXB0eSgpIHx8ICFpUE9OTy5pc0VtcHR5KCkgfHwgIWlPUkVGLmlzRW1wdHkoKSB8fCAhaUlWTk8uaXNFbXB0eSgpKSB7DQogICAgICBoYXNPcmRlckZpbHRlciA9IHRydWUNCiAgICAgIGlmICghaU9STk8uaXNFbXB0eSgpICYmIGlPUk5PLmxlbmd0aCgpID09IDEwKSB7DQogICAgICAgIG9yZGVyc0ZpbHRlciA9IHJ0dk9yZGVyc0J5T1JOTyhjdXN0b21lcnMsIGlPUk5PKQ0KICAgICAgfQ0KICAgICAgaWYgKCFpUE9OTy5pc0VtcHR5KCkgJiYgb3JkZXJzRmlsdGVyLmlzRW1wdHkoKSkgew0KICAgICAgICBydHZPcmRlcnNCeVBPTk8oY3VzdG9tZXJzKQ0KICAgICAgfQ0KICAgICAgaWYgKCFpT1JFRi5pc0VtcHR5KCkgJiYgb3JkZXJzRmlsdGVyLmlzRW1wdHkoKSAmJiBpT1JFRi5sZW5ndGgoKSA9PSAxNCkgew0KICAgICAgICBydHZPcmRlcnNCeU9SRUYoY3VzdG9tZXJzKQ0KICAgICAgfQ0KICAgICAgaWYgKCFpSVZOTy5pc0VtcHR5KCkgJiYgb3JkZXJzRmlsdGVyLmlzRW1wdHkoKSAmJiBpSVZOTy5sZW5ndGgoKSA8PSA5KSB7DQogICAgICAgIHJ0dk9yZGVyc0J5SVZOTyhjdXN0b21lcnMpDQogICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIGhhc09yZGVyRmlsdGVyDQogIH0NCg0KICAvKioNCiAgICogUmV0cmlldmVzIG9yZGVycyBieSBvcmRlciBudW1iZXIgYW5kIGN1c3RvbWVyIG51bWJlcnMuDQogICAqIEBwYXJhbSBjdXN0b21lcnMgQW4gYXJyYXkgb2YgY3VzdG9tZXIgbnVtYmVycw0KICAgKiBAcGFyYW0gb3JkZXJOdW1iZXIgVGhlIG9yZGVyIG51bWJlcg0KICAgKiBAcmV0dXJuIFRoZSBvcmRlcnMgZm91bmQNCiAgICovDQogIHB1YmxpYyBTdHJpbmcgcnR2T3JkZXJzQnlPUk5PKFN0cmluZ1tdIGN1c3RvbWVycywgU3RyaW5nIG9yZGVyTnVtYmVyKSB7DQogICAgU3RyaW5nIG9yZGVycyA9ICIiDQogICAgRXhwcmVzc2lvbkZhY3RvcnkgZXhwcmVzc2lvbiA9IGdldEdlbmVyaWNGaWx0ZXIoY3VzdG9tZXJzKQ0KDQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiT09IRUFEIikuaW5kZXgoIjAwIikubWF0Y2hpbmcoZXhwcmVzc2lvbikuc2VsZWN0aW9uKCJPQUNPTk8iLCAiT0FESVZJIiwgIk9BQ1VOTyIsICJPQU9STk8iLCAiT0FPUkRUIiwgIk9BT1JUUCIsICJPQU9SRUYiLCAiT0FSR0RUIiwgIk9BUkdUTSIsICJPQUxNVFMiLCAiT0FDVU9SIiwgIk9BT1JTTCIsICJPQU9SU1QiLCAiT0FPQkxDIiwgIk9BRFRJRCIsICJPQUNVQ0QiLCAiT0FURVBZIiwgIk9BTlRMQSIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9BQ09OTyIsIGlDT05PKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9BT1JOTyIsIG9yZGVyTnVtYmVyKQ0KICAgIGlmIChxdWVyeS5yZWFkKGNvbnRhaW5lcikpIHsNCiAgICAgIFN0cmluZyBvcm5vID0gY29udGFpbmVyLmdldCgiT0FPUk5PIikudG9TdHJpbmcoKQ0KICAgICAgaWYgKG9yZGVycy5pc0VtcHR5KCkpIHsNCiAgICAgICAgb3JkZXJzID0gb3Jubw0KICAgICAgfQ0KICAgICAgcGFnZVJlY29yZENvdW50ID0gcGFnZVJlY29yZENvdW50ICsgMQ0KICAgICAgU3RyaW5nIGhvdXIgPSBjb250YWluZXIuZ2V0KCJPQVJHVE0iKQ0KICAgICAgU3RyaW5nIHBhZGRlZCA9ICIwMDAwMDAiICsgaG91cg0KICAgICAgaG91ciA9IHBhZGRlZC5zdWJzdHJpbmcocGFkZGVkLmxlbmd0aCgpIC0gNikNCiAgICAgIFN0cmluZyByZ2R0ID0gY29udGFpbmVyLmdldCgiT0FSR0RUIikNCiAgICAgIFN0cmluZyBrZXkgPSByZ2R0ICsgaG91ciArIG9ybm8NCiAgICAgIEhhc2hNYXAgPCBTdHJpbmcsIFN0cmluZyA+IG9yZGVyID0gbmV3IEhhc2hNYXAgPCBTdHJpbmcsIFN0cmluZyA+ICgpDQogICAgICBvcmRlci5wdXQoIk9STk8iLCBvcm5vKQ0KICAgICAgb3JkZXIucHV0KCJSR0RUIiwgcmdkdCkNCiAgICAgIG9yZGVyLnB1dCgiUkdUTSIsIGNvbnRhaW5lci5nZXQoIk9BUkdUTSIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT1JUUCIsIGNvbnRhaW5lci5nZXQoIk9BT1JUUCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT1JFRiIsIGNvbnRhaW5lci5nZXQoIk9BT1JFRiIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiRElWSSIsIGNvbnRhaW5lci5nZXQoIk9BRElWSSIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiTE1UUyIsIGNvbnRhaW5lci5nZXQoIk9BTE1UUyIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiQ1VPUiIsIGNvbnRhaW5lci5nZXQoIk9BQ1VPUiIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT1JTVCIsIGNvbnRhaW5lci5nZXQoIk9BT1JTVCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT1JTTCIsIGNvbnRhaW5lci5nZXQoIk9BT1JTTCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT0JMQyIsIGNvbnRhaW5lci5nZXQoIk9BT0JMQyIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiRFRJRCIsIGNvbnRhaW5lci5nZXQoIk9BRFRJRCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiQ1VDRCIsIGNvbnRhaW5lci5nZXQoIk9BQ1VDRCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiQ1VOTyIsIGNvbnRhaW5lci5nZXQoIk9BQ1VOTyIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiVEVQWSIsIGNvbnRhaW5lci5nZXQoIk9BVEVQWSIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiTlRMQSIsIGNvbnRhaW5lci5nZXQoIk9BTlRMQSIpIGFzIFN0cmluZykNCiAgICAgIHBhZ2VPcmRlcnMucHV0KGtleSwgb3JkZXIpDQogICAgfQ0KICAgIHJldHVybiBvcmRlcnMNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXRyaWV2ZXMgb3JkZXJzIGJ5IHB1cmNoYXNlIG9yZGVyIG51bWJlciBhbmQgY3VzdG9tZXIgbnVtYmVycy4NCiAgICogQHBhcmFtIGN1c3RvbWVycyBBbiBhcnJheSBvZiBjdXN0b21lciBudW1iZXJzDQogICAqLw0KDQogIHB1YmxpYyB2b2lkIHJ0dk9yZGVyc0J5UE9OTyhTdHJpbmdbXSBjdXN0b21lcnMpIHsNCiAgICBTdHJpbmcgb3JkZXJzID0gIiINCiAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uID0gZ2V0R2VuZXJpY0ZpbHRlcihjdXN0b21lcnMpDQogICAgLy8gc2V0IEN1c3RvbWVyJ3MgUE8gbnVtYmVyIGZpbHRlcg0KICAgIGludCBsZW5ndGggPSBpUE9OTy5sZW5ndGgoKSA+IDE4ID8gMTggOiBpUE9OTy5sZW5ndGgoKQ0KICAgIFN0cmluZyBwb25vID0gIiUiICsgaVBPTk8udG9VcHBlckNhc2UoKS5zdWJzdHJpbmcoMCwgbGVuZ3RoKS50cmltKCkgKyAiJSINCiAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5hbmQoZXhwcmVzc2lvbi5saWtlKCJPQUNVT1IiLCBwb25vKSkNCg0KICAgIERCQWN0aW9uIHF1ZXJ5ID0gZGF0YWJhc2UudGFibGUoIk9PSEVBRCIpLmluZGV4KCIyMCIpLnJldmVyc2UoKS5tYXRjaGluZyhleHByZXNzaW9uKS5zZWxlY3Rpb24oIk9BQ09OTyIsICJPQURJVkkiLCAiT0FDVU5PIiwgIk9BT1JOTyIsICJPQU9SRFQiLCAiT0FPUlRQIiwgIk9BT1JFRiIsICJPQVJHRFQiLCAiT0FSR1RNIiwgIk9BTE1UUyIsICJPQUNVT1IiLCAiT0FPUlNMIiwgIk9BT1JTVCIsICJPQU9CTEMiLCAiT0FEVElEIiwgIk9BQ1VDRCIsICJPQVRFUFkiLCAiT0FOVExBIikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgY29udGFpbmVyLnNldCgiT0FDT05PIiwgaUNPTk8pDQogICAgcXVlcnkucmVhZEFsbChjb250YWluZXIsIDEsIG1heFBhZ2VTaXplLCByc1JlYWRPcmRlcnMpDQogIH0NCg0KICAvKioNCiAgICogUmV0cmlldmVzIG9yZGVycyBieSByZWZlcmVuY2UgbnVtYmVyIGFuZCBjdXN0b21lciBudW1iZXJzLg0KICAgKiBAcGFyYW0gY3VzdG9tZXJzIEFuIGFycmF5IG9mIGN1c3RvbWVyIG51bWJlcnMNCiAgICovDQogIHB1YmxpYyB2b2lkIHJ0dk9yZGVyc0J5T1JFRihTdHJpbmdbXSBjdXN0b21lcnMpIHsNCiAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uID0gZ2V0R2VuZXJpY0ZpbHRlcihjdXN0b21lcnMpDQogICAgLy8gc2V0IEVjb20gb3JkZXIgbnVtYmVyIGZpbHRlcg0KICAgIFN0cmluZyBvcmVmID0gIkVDIiArIGlPUkVGDQogICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uYW5kKGV4cHJlc3Npb24uZXEoIk9BT1JFRiIsIG9yZWYpKQ0KDQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiT09IRUFEIikuaW5kZXgoIjIwIikubWF0Y2hpbmcoZXhwcmVzc2lvbikuc2VsZWN0aW9uKCJPQUNPTk8iLCAiT0FESVZJIiwgIk9BQ1VOTyIsICJPQU9STk8iLCAiT0FPUkRUIiwgIk9BT1JUUCIsICJPQU9SRUYiLCAiT0FSR0RUIiwgIk9BUkdUTSIsICJPQUxNVFMiLCAiT0FDVU9SIiwgIk9BT1JTTCIsICJPQU9SU1QiLCAiT0FPQkxDIiwgIk9BRFRJRCIsICJPQUNVQ0QiLCAiT0FURVBZIiwgIk9BTlRMQSIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9BQ09OTyIsIGlDT05PKQ0KDQogICAgcXVlcnkucmVhZEFsbChjb250YWluZXIsIDEsIG1heFBhZ2VTaXplLCByc1JlYWRPcmRlcnMpDQogIH0NCg0KICAvKioNCiAgICogUmV0cmlldmVzIG9yZGVycyBieSBpbnZvaWNlIG51bWJlciBhbmQgY3VzdG9tZXIgbnVtYmVycy4NCiAgICogQHBhcmFtIGN1c3RvbWVycyBBbiBhcnJheSBvZiBjdXN0b21lciBudW1iZXJzDQogICAqLw0KDQogIHB1YmxpYyB2b2lkIHJ0dk9yZGVyc0J5SVZOTyhTdHJpbmdbXSBjdXN0b21lcnMpIHsNCiAgICBDbG9zdXJlIDwgPyA+IHJzUmVhZERlbE9yZGVycyA9IHsNCiAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciAtPg0KICAgICAgU3RyaW5nIG9ybm8gPSBjb250YWluZXIuZ2V0KCJVQU9STk8iKS50b1N0cmluZygpDQogICAgICBpZiAob3JubyAhPSBudWxsKSB7DQogICAgICAgIHJ0dk9yZGVyc0J5T1JOTyhjdXN0b21lcnMsIG9ybm8pDQogICAgICB9DQogICAgfQ0KDQogICAgRXhwcmVzc2lvbkZhY3RvcnkgZXhwcmVzc2lvbiA9IGRhdGFiYXNlLmdldEV4cHJlc3Npb25GYWN0b3J5KCJPREhFQUQiKQ0KICAgIC8vIHNldCBJbnZvaWNlIG51bWJlciBmaWx0ZXINCiAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5pbigiVUFDVU5PIiwgY3VzdG9tZXJzKS5hbmQoZXhwcmVzc2lvbi5lcSgiVUFJVk5PIiwgaUlWTk8pKQ0KDQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiT0RIRUFEIikuaW5kZXgoIjAwIikubWF0Y2hpbmcoZXhwcmVzc2lvbikuc2VsZWN0aW9uKCJVQU9STk8iKS5idWlsZCgpDQogICAgREJDb250YWluZXIgY29udGFpbmVyID0gcXVlcnkuZ2V0Q29udGFpbmVyKCkNCiAgICBjb250YWluZXIuc2V0KCJVQUNPTk8iLCBpQ09OTykNCiAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMSwgbWF4UGFnZVNpemUsIHJzUmVhZERlbE9yZGVycykNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXRyaWV2ZXMgdGhlIHRpcCBudW1iZXIgZm9yIGEgZ2l2ZW4gb3JkZXIgbnVtYmVyLg0KICAgKiBAcGFyYW0gb3JkZXJOdW1iZXIgVGhlIG9yZGVyIG51bWJlcg0KICAgKiBAcmV0dXJuIFRoZSB0aXAgbnVtYmVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgb3JkZXINCiAgICovDQoNCiAgcHVibGljIFN0cmluZyBnZXRUaXBOdW1iZXIoU3RyaW5nIG9yZGVyTnVtYmVyKSB7DQogICAgU3RyaW5nIHRpcE51bWJlciA9ICIiDQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiT09IRUFDIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJCRU9STk8iLCAiQkVBR041IikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgY29udGFpbmVyLnNldCgiQkVDT05PIiwgaUNPTk8pDQogICAgY29udGFpbmVyLnNldCgiQkVPUk5PIiwgb3JkZXJOdW1iZXIpDQogICAgaWYgKHF1ZXJ5LnJlYWQoY29udGFpbmVyKSkgew0KICAgICAgdGlwTnVtYmVyID0gY29udGFpbmVyLmdldCgiQkVBR041IikudG9TdHJpbmcoKQ0KDQogICAgfQ0KICAgIHJldHVybiB0aXBOdW1iZXINCiAgfQ0KDQogIC8qKg0KICAgKiBSZXRyaWV2ZXMgbGlua2VkIGN1c3RvbWVycyBmb3IgdGhlIGN1cnJlbnQgY3VzdG9tZXIuDQogICAqIEByZXR1cm4gQSBjb21tYS1zZXBhcmF0ZWQgc3RyaW5nIG9mIGxpbmtlZCBjdXN0b21lciBudW1iZXJzDQogICAqLw0KDQogIHB1YmxpYyBTdHJpbmcgZ2V0TGlua2VkQ3VzdG9tZXJzKCkgew0KICAgIFN0cmluZyBjdXN0b21lcnMgPSBpQ1VOTw0KICAgIENsb3N1cmUgPCA/ID4gcnNSZWFkQ3VzdG9tZXJzID0gew0KICAgICAgREJDb250YWluZXIgY29udGFpbmVyIC0+DQogICAgICBTdHJpbmcgY3VubyA9IGNvbnRhaW5lci5nZXQoIk9LQ1VOTyIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgICBpZiAoY3VubyAhPSBudWxsKSB7DQogICAgICAgIGlmICghY3Vuby5lcXVhbHMoaUNVTk8pKSB7DQogICAgICAgICAgY3VzdG9tZXJzID0gY3VzdG9tZXJzICsgIiwiICsgY3Vubw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiT0NVU01BIikNCiAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5lcSgiT0tDVVNUIiwgaUNVTk8pDQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiT0NVU01BIikuaW5kZXgoIjAwIikubWF0Y2hpbmcoZXhwcmVzc2lvbikuc2VsZWN0aW9uKCJPS0NVTk8iLCAiT0tDVVNUIikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgY29udGFpbmVyLnNldCgiT0tDT05PIiwgaUNPTk8pDQogICAgY29udGFpbmVyLnNldCgiT0tDVVNUIiwgaUNVTk8pDQoNCiAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMSwgbWF4UGFnZVNpemUsIHJzUmVhZEN1c3RvbWVycykNCiAgICByZXR1cm4gY3VzdG9tZXJzDQogIH0NCg0KICAvKioNCiAgICpHZXQgcmVjb3JkcyBmcm9tIE9PSEVBRCB0YWJsZQ0KICAgKiBAcGFyYW1zIA0KICAgKiBAcmV0dXJuIA0KICAgKi8NCiAgcHVibGljIHZvaWQgcmVhZE9yZGVycygpIHsNCiAgICBib29sZWFuIGRydG4gPSBmYWxzZQ0KICAgIC8vTGltaXQgcmV0dXJuZWQgcmVjb3JkcyBiYXNlZCBvbiBwYWdlIG51bWJlcg0KICAgIGludCBwYWdlTnVtID0gaVBOVU0gYXMgSW50ZWdlcg0KICAgIGludCBwYWdlUmVjb3JkTWF4ID0gKHBhZ2VOdW0gKyAxKSAqIHBhZ2VTaXplDQoNCiAgICAvLyBSZXRyaWV2ZSBsaW5rZWQgY3VzdG9tZXJzIGJhc2VkIG9uIE9LQ1VTVA0KICAgIFN0cmluZ1tdIGN1c3RvbWVycyA9IGdldExpbmtlZEN1c3RvbWVycygpLnNwbGl0KCIsIikNCg0KICAgIC8vSWYgZHVyYXRpb24gaXMgc2V0IHRoZW4gY2xlYXIgb3RoZXIgZmlsdGVycyBhbmQgc2hvdWxkIHVzZSB0aW1lc3RhbXAgY29uZGl0aW9uIG9ubHkNCiAgICBpZiAoIWlEUlROLmlzRW1wdHkoKSkgew0KICAgICAgaW50IGR1cmF0aW9uID0gaURSVE4gYXMgSW50ZWdlcg0KICAgICAgaUZSRFQgPSAiIg0KICAgICAgaVRPRFQgPSAiIg0KICAgICAgaVBPTk8gPSAiIg0KICAgICAgaU9STk8gPSAiIg0KICAgICAgaUxPUk4gPSAiIg0KICAgICAgaU9SRUYgPSAiIg0KICAgICAgaUlWTk8gPSAiIg0KICAgICAgaUlUTk8gPSAiIg0KICAgICAgZHJ0biA9IHRydWUNCiAgICAgIENhbGVuZGFyIGNhbCA9IENhbGVuZGFyLmdldEluc3RhbmNlKCkNCiAgICAgIGNhbC5hZGQoQ2FsZW5kYXIuTUlOVVRFLCAtZHVyYXRpb24pDQogICAgICB0aW1lc3RhbXAgPSBjYWwuZ2V0VGltZUluTWlsbGlzKCkNCiAgICB9DQoNCiAgICBpZiAocmVhZE9yZGVyc1dpdGhGaWx0ZXIoY3VzdG9tZXJzKSkgew0KICAgICAgcmV0dXJuDQogICAgfQ0KDQogICAgRXhwcmVzc2lvbkZhY3RvcnkgZXhwcmVzc2lvbiA9IGdldEdlbmVyaWNGaWx0ZXIoY3VzdG9tZXJzKQ0KICAgIC8vIHNldCBUaW1lc3RhbXAgZmlsdGVyDQogICAgaWYgKCFpRFJUTi5pc0VtcHR5KCkpIHsNCiAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmFuZChleHByZXNzaW9uLmdlKCJPQUxNVFMiLCB0aW1lc3RhbXAgYXMgU3RyaW5nKSkNCiAgICB9DQoNCiAgICBEQkFjdGlvbiBxdWVyeSA9IGRhdGFiYXNlLnRhYmxlKCJPT0hFQUQiKS5pbmRleCgiMjAiKS5yZXZlcnNlKCkubWF0Y2hpbmcoZXhwcmVzc2lvbikuc2VsZWN0aW9uKCJPQUNPTk8iLCAiT0FESVZJIiwgIk9BQ1VOTyIsICJPQU9STk8iLCAiT0FPUkRUIiwgIk9BT1JUUCIsICJPQU9SRUYiLCAiT0FSR0RUIiwgIk9BUkdUTSIsICJPQUxNVFMiLCAiT0FDVU9SIiwgIk9BT1JTTCIsICJPQU9SU1QiLCAiT0FPQkxDIiwgIk9BRFRJRCIsICJPQUNVQ0QiLCAiT0FURVBZIiwgIk9BTlRMQSIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9BQ09OTyIsIGlDT05PKQ0KICAgIC8vY29udGFpbmVyLnNldCgiT0FDVU5PIiwgaUNVTk8pDQoNCiAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMSwgcGFnZVJlY29yZE1heCwgcnNSZWFkT3JkZXJzKQ0KICB9DQoNCiAgQ2xvc3VyZSA8ID8gPiByc1JlYWRPcmRlcnMgPSB7DQogICAgREJDb250YWluZXIgY29udGFpbmVyIC0+DQogICAgU3RyaW5nIG9ybm8gPSBjb250YWluZXIuZ2V0KCJPQU9STk8iKS50b1N0cmluZygpDQogICAgaWYgKG9ybm8gIT0gbnVsbCkgew0KICAgICAgcGFnZVJlY29yZENvdW50ID0gcGFnZVJlY29yZENvdW50ICsgMQ0KICAgICAgU3RyaW5nIGhvdXIgPSBjb250YWluZXIuZ2V0KCJPQVJHVE0iKQ0KICAgICAgU3RyaW5nIHBhZGRlZCA9ICIwMDAwMDAiICsgaG91cg0KICAgICAgaG91ciA9IHBhZGRlZC5zdWJzdHJpbmcocGFkZGVkLmxlbmd0aCgpIC0gNikNCiAgICAgIFN0cmluZyByZ2R0ID0gY29udGFpbmVyLmdldCgiT0FSR0RUIikNCiAgICAgIFN0cmluZyBrZXkgPSByZ2R0ICsgaG91ciArIG9ybm8NCiAgICAgIEhhc2hNYXAgPCBTdHJpbmcsIFN0cmluZyA+IG9yZGVyID0gbmV3IEhhc2hNYXAgPCBTdHJpbmcsIFN0cmluZyA+ICgpDQogICAgICBvcmRlci5wdXQoIk9STk8iLCBvcm5vKQ0KICAgICAgb3JkZXIucHV0KCJSR0RUIiwgcmdkdCkNCiAgICAgIG9yZGVyLnB1dCgiUkdUTSIsIGNvbnRhaW5lci5nZXQoIk9BUkdUTSIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT1JUUCIsIGNvbnRhaW5lci5nZXQoIk9BT1JUUCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT1JFRiIsIGNvbnRhaW5lci5nZXQoIk9BT1JFRiIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiRElWSSIsIGNvbnRhaW5lci5nZXQoIk9BRElWSSIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiTE1UUyIsIGNvbnRhaW5lci5nZXQoIk9BTE1UUyIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiQ1VPUiIsIGNvbnRhaW5lci5nZXQoIk9BQ1VPUiIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT1JTVCIsIGNvbnRhaW5lci5nZXQoIk9BT1JTVCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT1JTTCIsIGNvbnRhaW5lci5nZXQoIk9BT1JTTCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiT0JMQyIsIGNvbnRhaW5lci5nZXQoIk9BT0JMQyIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiRFRJRCIsIGNvbnRhaW5lci5nZXQoIk9BRFRJRCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiQ1VDRCIsIGNvbnRhaW5lci5nZXQoIk9BQ1VDRCIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiQ1VOTyIsIGNvbnRhaW5lci5nZXQoIk9BQ1VOTyIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiVEVQWSIsIGNvbnRhaW5lci5nZXQoIk9BVEVQWSIpIGFzIFN0cmluZykNCiAgICAgIG9yZGVyLnB1dCgiTlRMQSIsIGNvbnRhaW5lci5nZXQoIk9BTlRMQSIpIGFzIFN0cmluZykNCiAgICAgIHBhZ2VPcmRlcnMucHV0KGtleSwgb3JkZXIpDQogICAgICBpZiAoaGFzT3JkZXJGaWx0ZXIpIHsNCiAgICAgICAgb3JkZXJzRmlsdGVyID0gb3Jubw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgb3JkZXJzRmlsdGVyID0gb3JkZXJzRmlsdGVyICsgIiwiICsgb3Jubw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBSZXRyaWV2ZXMgYSBnZW5lcmljIGZpbHRlciBleHByZXNzaW9uIGZvciBxdWVyeWluZyBvcmRlcnMgYmFzZWQgb24gY3VzdG9tZXIgbnVtYmVycyBhbmQgb3RoZXIgY3JpdGVyaWEuDQogICAqIEBwYXJhbSBjdXN0b21lcnMgQW4gYXJyYXkgb2YgY3VzdG9tZXIgbnVtYmVycw0KICAgKiBAcmV0dXJuIFRoZSBFeHByZXNzaW9uRmFjdG9yeSByZXByZXNlbnRpbmcgdGhlIGZpbHRlciBleHByZXNzaW9uDQogICAqLw0KDQogIHByaXZhdGUgRXhwcmVzc2lvbkZhY3RvcnkgZ2V0R2VuZXJpY0ZpbHRlcihTdHJpbmdbXSBjdXN0b21lcnMpIHsNCiAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uID0gZGF0YWJhc2UuZ2V0RXhwcmVzc2lvbkZhY3RvcnkoIk9PSEVBRCIpDQogICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uaW4oIk9BQ1VOTyIsIGN1c3RvbWVycykuYW5kKGV4cHJlc3Npb24uZXEoIk9BRElWSSIsIGlESVZJKSkNCiAgICAvL0Rvbid0IGluY2x1ZGUgcmV0dXJuIG9yZGVycw0KICAgIFN0cmluZyByZXRPcnRwcyA9IGdldFRyYW5zbGF0aW9uKCJFQ1pFWENPUlRQIikNCiAgICBpZiAoIXJldE9ydHBzLmlzRW1wdHkoKSkgew0KICAgICAgU3RyaW5nW10gcmV0T3J0cExpc3QgPSByZXRPcnRwcy5zcGxpdCgiLCIpDQogICAgICBmb3IgKFN0cmluZyByZXRPcnRwOiByZXRPcnRwTGlzdCkgew0KICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5hbmQoZXhwcmVzc2lvbi5uZSgiT0FPUlRQIiwgcmV0T3J0cCkpDQogICAgICB9DQogICAgfQ0KICAgIC8vRG9uJ3QgaW5jbHVkZSBjYW5jZWxsZWQgb3JkZXJzDQogICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uYW5kKGV4cHJlc3Npb24ubmUoIk9BT1JTVCIsICI5MCIpKS5hbmQoZXhwcmVzc2lvbi5uZSgiT0FPUlNMIiwgIjkwIikpDQogICAgLy9JbmNsdWRlIG9ydHAgSU4gc3RhdGVtZW50IA0KICAgIGlmICghaU9SVFAuaXNFbXB0eSgpKSB7DQogICAgICBTdHJpbmcgaW5PcnRwcyA9IGdldFRyYW5zbGF0aW9uKCJFQ1oiICsgaU9SVFAudG9VcHBlckNhc2UoKSkNCiAgICAgIGlmICghaW5PcnRwcy5pc0VtcHR5KCkpIHsNCiAgICAgICAgU3RyaW5nW10gaW5PcnRwTGlzdCA9IGluT3J0cHMuc3BsaXQoIiwiKQ0KICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5pbigiT0FPUlRQIiwgaW5PcnRwTGlzdCkNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvL3NldCBGcm9tIERhdGUgZmlsdGVyDQogICAgaWYgKCFpRlJEVC5pc0VtcHR5KCkpIHsNCiAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmFuZChleHByZXNzaW9uLmdlKCJPQU9SRFQiLCBpRlJEVCkpDQogICAgfQ0KICAgIC8vIHNldCBUbyBEYXRlIGZpbHRlcg0KICAgIGlmICghaVRPRFQuaXNFbXB0eSgpKSB7DQogICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5hbmQoZXhwcmVzc2lvbi5sZSgiT0FPUkRUIiwgaVRPRFQpKQ0KICAgIH0NCiAgICAvLyBzZXQgU3RhdHVzIGZpbHRlcg0KICAgIGlmICghaVNUQVQuaXNFbXB0eSgpKSB7DQogICAgICBpZiAoaVNUQVQuZXF1YWxzKCJJbiBQcm9ncmVzcyIpKSB7DQogICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmFuZChleHByZXNzaW9uLmx0KCJPQU9SU1QiLCAiNjYiKSkNCiAgICAgIH0gZWxzZSBpZiAoaVNUQVQuZXF1YWxzKCJQYXJ0aWFsbHlTaGlwcGVkIikpIHsNCiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uYW5kKGV4cHJlc3Npb24uZ2UoIk9BT1JTVCIsICI2NiIpKS5hbmQoZXhwcmVzc2lvbi5sdCgiT0FPUlNMIiwgIjY2IikpDQogICAgICB9IGVsc2UgaWYgKGlTVEFULmVxdWFscygiU2hpcHBlZCIpKSB7DQogICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmFuZChleHByZXNzaW9uLmdlKCJPQU9SU1QiLCAiNjYiKSkuYW5kKGV4cHJlc3Npb24uZ2UoIk9BT1JTTCIsICI2NiIpKQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gZXhwcmVzc2lvbg0KICB9DQoNCiAgLyoqDQogICAqIGdldFRyYW5zbGF0aW9uIC0gR2V0IHRoZSBDUlM4ODEgZGF0YSB0cmFuc2xhdGlvbiB1c2luZyBhIFN0cmluZyBrZXl3b3JkDQogICAqIEBwYXJhbXMgU3RyaW5nIGtleXdvcmQNCiAgICogQHJldHVybiBTdHJpbmcNCiAgICovDQogIHByaXZhdGUgU3RyaW5nIGdldFRyYW5zbGF0aW9uKFN0cmluZyBrZXl3b3JkKSB7DQogICAgaWYgKHRyYW5zbGF0aW9uSWQgPT0gMCkgew0KICAgICAgTWFwIDwgU3RyaW5nLCBTdHJpbmcgPiBwYXJhbXMgPSBbIkNPTk8iOiBpQ09OTy50b1N0cmluZygpLnRyaW0oKSwgIkRJVkkiOiAiIiwgIlRSUUYiOiAiMCIsICJNU1REIjogIkVDT00iLCAiTVZSUyI6ICIxIiwgIkJNU0ciOiAiRUNaMDAxTUkiLCAiSUJPQiI6ICJPIiwgIkVMTVAiOiAiQVBJIiwgIkVMTUQiOiAiUHJvcGVydGllcyJdDQogICAgICBDbG9zdXJlIDwgPyA+IGNhbGxiYWNrID0gew0KICAgICAgICBNYXAgPCBTdHJpbmcsDQogICAgICAgIFN0cmluZyA+IHJlc3BvbnNlIC0+DQogICAgICAgIGlmIChyZXNwb25zZS5JRFRSICE9IG51bGwpIHsNCiAgICAgICAgICB0cmFuc2xhdGlvbklkID0gcmVzcG9uc2UuSURUUiBhcyBJbnRlZ2VyDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIG1pQ2FsbGVyLmNhbGwoIkNSUzg4MU1JIiwgIkdldFRyYW5zbGF0aW9uIiwgcGFyYW1zLCBjYWxsYmFjaykNCiAgICB9DQoNCiAgICBTdHJpbmcgbWJtZCA9ICIiDQogICAgaWYgKHRyYW5zbGF0aW9uSWQgIT0gMCkgew0KICAgICAgQ2xvc3VyZSA8ID8gPiBnZXRUcmFuc2xhdGVkRGF0YSA9IHsNCiAgICAgICAgREJDb250YWluZXIgY29udGFpbmVyIC0+DQogICAgICAgIG1ibWQgPSBjb250YWluZXIuZ2V0KCJURE1CTUQiKQ0KICAgICAgICBpZiAobWJtZCA9PSBudWxsKSB7DQogICAgICAgICAgbWJtZCA9ICIiDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIERCQWN0aW9uIHF1ZXJ5ID0gZGF0YWJhc2UudGFibGUoIk1CTVRSRCIpLmluZGV4KCIzMCIpLnNlbGVjdGlvbigiVERNQk1EIikuYnVpbGQoKQ0KICAgICAgREJDb250YWluZXIgY29udGFpbmVyID0gcXVlcnkuZ2V0Q29udGFpbmVyKCkNCiAgICAgIGNvbnRhaW5lci5zZXQoIlREQ09OTyIsIGlDT05PKQ0KICAgICAgY29udGFpbmVyLnNldCgiVERESVZJIiwgIiIpDQogICAgICBjb250YWluZXIuc2V0KCJURElEVFIiLCB0cmFuc2xhdGlvbklkIGFzIEludGVnZXIpDQogICAgICBjb250YWluZXIuc2V0KCJURE1WWEQiLCBrZXl3b3JkKQ0KICAgICAgcXVlcnkucmVhZEFsbChjb250YWluZXIsIDQsIG1heFBhZ2VTaXplLCBnZXRUcmFuc2xhdGVkRGF0YSkNCiAgICB9DQogICAgcmV0dXJuIG1ibWQudHJpbSgpDQogIH0NCg0KICAvKioNCiAgICogRGV0ZXJtaW5lcyB0aGUgc3RhdHVzIG9mIGFuIG9yZGVyIGJhc2VkIG9uIGl0cyBzaGlwcGluZyBhbmQgcHJvY2Vzc2luZyBzdGF0dXNlcy4NCiAgICogQHBhcmFtIG9yc2wgVGhlIHNoaXBwaW5nIHN0YXR1cyBvZiB0aGUgb3JkZXINCiAgICogQHBhcmFtIG9yc3QgVGhlIHByb2Nlc3Npbmcgc3RhdHVzIG9mIHRoZSBvcmRlcg0KICAgKiBAcmV0dXJuIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgc3RhdHVzDQogICAqLw0KICBwdWJsaWMgU3RyaW5nIGdldE9yZGVyU3RhdHVzKGludCBvcnNsLCBpbnQgb3JzdCkgew0KICAgIFN0cmluZyBzdGF0dXMgPSAiIg0KICAgIGlmICgob3JzbCA9PSA3NyAmJiBvcnN0ID09IDc3KSB8fCAob3JzbCA+PSA2NiAmJiBvcnNsIDwgOTAgJiYgb3JzdCA+PSA2NiAmJiBvcnN0IDwgOTApKSB7DQogICAgICBzdGF0dXMgPSAiU2hpcHBlZCINCiAgICB9IGVsc2UgaWYgKG9yc2wgPCA2NiAmJiBvcnN0ID49IDY2ICYmIG9yc3QgPCA5MCkgew0KICAgICAgc3RhdHVzID0gIlBhcnRpYWxseSBzaGlwcGVkIg0KICAgIH0gZWxzZSBpZiAob3JzbCA8IDY2ICYmIG9yc3QgPCA2Nikgew0KICAgICAgc3RhdHVzID0gIlN1Ym1pdHRlZCINCiAgICB9IGVsc2UgaWYgKG9yc2wgPT0gOTAgJiYgb3JzdCA9PSA5MCkgew0KICAgICAgc3RhdHVzID0gIkNhbmNlbGxlZCINCiAgICB9IGVsc2Ugew0KICAgICAgc3RhdHVzID0gb3JzbCArICIvIiArIG9yc3QNCiAgICB9DQogICAgcmV0dXJuIHN0YXR1cw0KICB9DQoNCiAgLyoqDQogICAqR2V0IGRhdGEgZnJvbSBNSERJU0ggdGFibGUNCiAgICogQHBhcmFtcyANCiAgICogQHJldHVybiANCiAgICovDQogIHB1YmxpYyBIYXNoTWFwIHJlYWREZWxpdmVyaWVzKFN0cmluZyBjdW5vLCBTdHJpbmcgb3JubywgU3RyaW5nIHRlcHksIFN0cmluZyB6U3RhdHVzKSB7DQogICAgSGFzaE1hcCA8IFN0cmluZywgU3RyaW5nID4gZGVsaXZlcnkgPSBuZXcgSGFzaE1hcCA8IFN0cmluZywgU3RyaW5nID4gKCkNCiAgICBpbnQgY291bnRlciA9IDANCiAgICBTdHJpbmcgZXRybiA9ICIiDQogICAgU3RyaW5nIHNoaXBEYXRlID0gIjAiDQogICAgU3RyaW5nIGNhcnIgPSAiIg0KICAgIFN0cmluZyBtb2RsID0gIiINCiAgICBDbG9zdXJlIDwgPyA+IHJzUmVhZERlbGl2ZXJpZXMgPSB7DQogICAgICBEQkNvbnRhaW5lciBjb250YWluZXIgLT4NCiAgICAgIFN0cmluZyBkbGl4ID0gY29udGFpbmVyLmdldCgiT1FETElYIikudG9TdHJpbmcoKQ0KICAgICAgaWYgKGRsaXggIT0gbnVsbCkgew0KICAgICAgICBpZiAoY291bnRlciA9PSAwKSB7DQogICAgICAgICAgc2hpcERhdGUgPSBjb250YWluZXIuZ2V0KCJPUURTRFQiKQ0KICAgICAgICAgIGV0cm4gPSBjb250YWluZXIuZ2V0KCJPUUVUUk4iKS50b1N0cmluZygpLnRyaW0oKQ0KICAgICAgICAgIFN0cmluZyBtb2RmID0gY29udGFpbmVyLmdldCgiT1FNT0RGIikudG9TdHJpbmcoKS50cmltKCkNCiAgICAgICAgICBpZiAoIW1vZGYuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBjYXJyID0gbW9kZg0KICAgICAgICAgICAgbW9kbCA9IG1vZGYNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY2FyciA9IGNvbnRhaW5lci5nZXQoIk9RTU9ETCIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgICAgICAgICBtb2RsID0gY29udGFpbmVyLmdldCgiT1FNT0RMIikudG9TdHJpbmcoKS50cmltKCkNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgU3RyaW5nIHRyY2tOdW0gPSBjb250YWluZXIuZ2V0KCJPUUVUUk4iKS50b1N0cmluZygpLnRyaW0oKQ0KICAgICAgICAgIGlmICghZXRybi5pc0VtcHR5KCkgJiYgIXRyY2tOdW0uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBldHJuID0gZXRybiArICIsIiArIHRyY2tOdW0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY291bnRlciA9IGNvdW50ZXIgKyAxDQogICAgICAgIGludCBwZ3JzID0gKGNvbnRhaW5lci5nZXQoIk9RUEdSUyIpLnRvU3RyaW5nKCkpIGFzIEludGVnZXINCg0KICAgICAgICBpZiAoelN0YXR1cy5lcXVhbHMoIlN1Ym1pdHRlZCIpKSB7DQogICAgICAgICAgaW50IGRzZHQgPSBjb250YWluZXIuZ2V0KCJPUURTRFQiKSBhcyBJbnRlZ2VyDQogICAgICAgICAgaW50IHNoZHQgPSBzaGlwRGF0ZSBhcyBJbnRlZ2VyDQogICAgICAgICAgaWYgKGRzZHQgPCBzaGR0IHx8IHNoZHQgPT0gMCkgew0KICAgICAgICAgICAgc2hpcERhdGUgPSBkc2R0IGFzIFN0cmluZw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmICgoelN0YXR1cy5lcXVhbHMoIlBhcnRpYWxseSBzaGlwcGVkIikgfHwgelN0YXR1cy5lcXVhbHMoIlNoaXBwZWQiKSkgJiYgcGdycyA+IDUwKSB7DQogICAgICAgICAgLy8gUmVhZCBPREhFQUQgYW5kIEZTTEVERw0KICAgICAgICAgIEhhc2hNYXAgPCBTdHJpbmcsIFN0cmluZyA+IGR2ID0gZ2V0RGVsaXZlcnlEYXRlKG9ybm8sIGNvbnRhaW5lci5nZXQoIk9RV0hMTyIpLnRvU3RyaW5nKCksIGNvbnRhaW5lci5nZXQoIk9RRExJWCIpLnRvU3RyaW5nKCksIHRlcHkpDQogICAgICAgICAgaW50IGRzZHQgPSBkdi5nZXQoIkRMRFQiKSBhcyBJbnRlZ2VyDQogICAgICAgICAgaW50IHNoZHQgPSBzaGlwRGF0ZSBhcyBJbnRlZ2VyDQogICAgICAgICAgaWYgKGRzZHQgPCBzaGR0ICYmIGRzZHQgIT0gMCkgew0KICAgICAgICAgICAgc2hpcERhdGUgPSBkc2R0IGFzIFN0cmluZw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiTUhESVNIIikNCiAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5lcSgiT1FSSUROIiwgb3JubykuYW5kKGV4cHJlc3Npb24uZXEoIk9RUk9SQyIsICIzIikpDQoNCiAgICBEQkFjdGlvbiBxdWVyeSA9IGRhdGFiYXNlLnRhYmxlKCJNSERJU0giKS5pbmRleCgiNjAiKS5tYXRjaGluZyhleHByZXNzaW9uKS5zZWxlY3Rpb24oIk9RRFNEVCIsICJPUU1PREYiLCAiT1FNT0RMIiwgIk9RRVRSTiIsICJPUVBHUlMiLCAiT1FXSExPIiwgIk9RRExJWCIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9RQ09OTyIsIGlDT05PKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9RSU5PVSIsIDEpDQogICAgY29udGFpbmVyLnNldCgiT1FDT05BIiwgY3VubykNCiAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMywgbWF4UGFnZVNpemUsIHJzUmVhZERlbGl2ZXJpZXMpDQoNCiAgICBjYXJyID0gZ2V0Q2FycmllcihjYXJyKQ0KICAgIGRlbGl2ZXJ5LnB1dCgiRFNEVCIsIHNoaXBEYXRlIGFzIFN0cmluZykNCiAgICBkZWxpdmVyeS5wdXQoIkNBUlIiLCBjYXJyIGFzIFN0cmluZykNCiAgICBkZWxpdmVyeS5wdXQoIk1PREwiLCBtb2RsIGFzIFN0cmluZykNCiAgICBkZWxpdmVyeS5wdXQoIkVUUk4iLCBldHJuIGFzIFN0cmluZykNCiAgICByZXR1cm4gZGVsaXZlcnkNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXRyaWV2ZXMgdGhlIGNhcnJpZXIgbmFtZSBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgbW9kZWwuDQogICAqIEBwYXJhbSBtb2RsIFRoZSBtb2RlbCBmb3Igd2hpY2ggdG8gcmV0cmlldmUgdGhlIGNhcnJpZXIgbmFtZQ0KICAgKiBAcmV0dXJuIFRoZSBjYXJyaWVyIG5hbWUNCiAgICovDQoNCiAgcHVibGljIFN0cmluZyBnZXRDYXJyaWVyKFN0cmluZyBtb2RsKSB7DQogICAgU3RyaW5nIGNhcnJpZXIgPSAiIg0KICAgIERCQWN0aW9uIHF1ZXJ5ID0gZGF0YWJhc2UudGFibGUoIkNTWVRBQiIpLmluZGV4KCIwMCIpLnNlbGVjdGlvbigiQ1RUWDE1IikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgY29udGFpbmVyLnNldCgiQ1RDT05PIiwgaUNPTk8pDQogICAgY29udGFpbmVyLnNldCgiQ1RESVZJIiwgIiIpDQogICAgY29udGFpbmVyLnNldCgiQ1RMTkNEIiwgIkdCIikNCiAgICBjb250YWluZXIuc2V0KCJDVFNUQ08iLCAiTU9ETCIpDQogICAgY29udGFpbmVyLnNldCgiQ1RTVEtZIiwgbW9kbCkNCiAgICBpZiAocXVlcnkucmVhZChjb250YWluZXIpKSB7DQogICAgICBjYXJyaWVyID0gY29udGFpbmVyLmdldCgiQ1RUWDE1IikudG9TdHJpbmcoKQ0KICAgIH0NCiAgICByZXR1cm4gY2Fycmllcg0KICB9DQoNCiAgLyoqDQogICAqIFJldHJpZXZlcyBkZWxpdmVyeSBkYXRlIGluZm9ybWF0aW9uIGJhc2VkIG9uIHRoZSBvcmRlciBudW1iZXIsIHdhcmVob3VzZSwgZGVsaXZlcnkgaW5kZXgsIGFuZCBvcmRlciB0eXBlLg0KICAgKiBAcGFyYW0gb3JubyBUaGUgb3JkZXIgbnVtYmVyDQogICAqIEBwYXJhbSB3aGxvIFRoZSB3YXJlaG91c2UgbG9jYXRpb24NCiAgICogQHBhcmFtIGRsaXggVGhlIGRlbGl2ZXJ5IGluZGV4DQogICAqIEBwYXJhbSB0ZXB5IFRoZSBvcmRlciB0eXBlDQogICAqIEByZXR1cm4gQSBIYXNoTWFwIGNvbnRhaW5pbmcgZGVsaXZlcnkgZGF0ZSBpbmZvcm1hdGlvbg0KICAgKi8NCg0KICBwdWJsaWMgSGFzaE1hcCA8IFN0cmluZywgU3RyaW5nID4gZ2V0RGVsaXZlcnlEYXRlKFN0cmluZyBvcm5vLCBTdHJpbmcgd2hsbywgU3RyaW5nIGRsaXgsIFN0cmluZyB0ZXB5KSB7DQogICAgSGFzaE1hcCA8IFN0cmluZywgU3RyaW5nID4gZGVsSW5mbyA9IG5ldyBIYXNoTWFwIDwgU3RyaW5nLCBTdHJpbmcgPiAoKQ0KICAgIFN0cmluZyBzaGlwRGF0ZSA9ICIwIg0KDQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiT0RIRUFEIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJVQURMRFQiLCAiVUFESVZJIiwgIlVBUFlOTyIsICJVQUlWTk8iLCAiVUFZRUE0IiwgIlVBQ1VOTyIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgIGNvbnRhaW5lci5zZXQoIlVBQ09OTyIsIGlDT05PKQ0KICAgIGNvbnRhaW5lci5zZXQoIlVBT1JOTyIsIG9ybm8pDQogICAgY29udGFpbmVyLnNldCgiVUFXSExPIiwgd2hsbykNCiAgICBjb250YWluZXIuc2V0KCJVQURMSVgiLCBkbGl4IGFzIGxvbmcpDQogICAgY29udGFpbmVyLnNldCgiVUFURVBZIiwgdGVweSkNCiAgICBpZiAocXVlcnkucmVhZChjb250YWluZXIpKSB7DQogICAgICBzaGlwRGF0ZSA9IGNvbnRhaW5lci5nZXQoIlVBRExEVCIpLnRvU3RyaW5nKCkNCiAgICB9DQogICAgZGVsSW5mby5wdXQoIkRMRFQiLCBzaGlwRGF0ZSkNCg0KICAgIHJldHVybiBkZWxJbmZvDQogIH0NCg0KICAvKioNCiAgICogUmV0cmlldmVzIHNoaXBwaW5nIGNoYXJnZXMgZm9yIGEgZ2l2ZW4gb3JkZXIgbnVtYmVyLg0KICAgKiBAcGFyYW0gb3JubyBUaGUgb3JkZXIgbnVtYmVyIGZvciB3aGljaCB0byByZXRyaWV2ZSBzaGlwcGluZyBjaGFyZ2VzDQogICAqLw0KICBwdWJsaWMgdm9pZCBydHZTaGlwcGluZ0NoYXJnZXMoU3RyaW5nIG9ybm8pIHsNCiAgICAvL2RvdWJsZVtdIGNoYXJnZXMgPSBuZXcgZG91YmxlWzNdDQogICAgY2hyZyA9IDAuMA0KICAgIGZydCA9IDAuMA0KICAgIHRheENoYXJnZSA9IDAuMA0KICAgIENsb3N1cmUgPCA/ID4gcnNSZWFkTUhESVNIID0gew0KICAgICAgREJDb250YWluZXIgY29udGFpbmVyIC0+DQogICAgICBTdHJpbmcgZGxpeCA9IGNvbnRhaW5lci5nZXQoIk9RRExJWCIpIGFzIFN0cmluZw0KICAgICAgU3RyaW5nIHdobG8gPSBjb250YWluZXIuZ2V0KCJPUVdITE8iKQ0KICAgICAgaWYgKGRsaXggIT0gbnVsbCkgew0KICAgICAgICBydHZDaGFyZ2VzKG9ybm8sIGRsaXgsIHdobG8pDQogICAgICB9DQogICAgfQ0KICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiTUhESVNIIikNCiAgICAvLyBzZXQgb3JkZXIgbnVtYmVyIGZpbHRlcg0KICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmVxKCJPUVJJRE4iLCBvcm5vKS5hbmQoZXhwcmVzc2lvbi5lcSgiT1FUVFlQIiwgIjMxIikpDQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiTUhESVNIIikuaW5kZXgoIjAwIikubWF0Y2hpbmcoZXhwcmVzc2lvbikuc2VsZWN0aW9uKCJPUVdITE8iLCAiT1FETElYIikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgY29udGFpbmVyLnNldCgiT1FDT05PIiwgaUNPTk8pDQogICAgY29udGFpbmVyLnNldCgiT1FJTk9VIiwgMSkNCiAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMiwgbWF4UGFnZVNpemUsIHJzUmVhZE1IRElTSCkNCg0KICAgIHJ0dkNoYXJnZXMob3JubywgIjAiLCAiIikNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXRyaWV2ZXMgY2hhcmdlcyBmb3IgYSBnaXZlbiBvcmRlciBudW1iZXIsIGRlbGl2ZXJ5IGluZGV4LCBhbmQgd2FyZWhvdXNlIGxvY2F0aW9uLg0KICAgKiBAcGFyYW0gb3JubyBUaGUgb3JkZXIgbnVtYmVyDQogICAqIEBwYXJhbSBkbGl4IFRoZSBkZWxpdmVyeSBpbmRleA0KICAgKiBAcGFyYW0gd2hsbyBUaGUgd2FyZWhvdXNlIGxvY2F0aW9uDQogICAqLw0KDQogIHB1YmxpYyB2b2lkIHJ0dkNoYXJnZXMoU3RyaW5nIG9ybm8sIFN0cmluZyBkbGl4LCBTdHJpbmcgd2hsbykgew0KICAgIENsb3N1cmUgPCA/ID4gcnNSZWFkT09DSFJHID0gew0KICAgICAgREJDb250YWluZXIgY29udGFpbmVyIC0+DQogICAgICBTdHJpbmcgY3JpZCA9IGNvbnRhaW5lci5nZXQoIk9FQ1JJRCIpLnRvU3RyaW5nKCkudHJpbSgpDQogICAgICBpZiAoY3JpZCAhPSBudWxsKSB7DQogICAgICAgIGRvdWJsZSBjcmFtID0gY29udGFpbmVyLmdldCgiT0VDUkFNIikgYXMgRG91YmxlDQogICAgICAgIGlmICghZGxpeC5lcXVhbHMoIjAiKSkgew0KICAgICAgICAgIGlmIChjcmlkLnN0YXJ0c1dpdGgoIkZSVCIpKSB7DQogICAgICAgICAgICBmcnQgPSBmcnQgKyBjcmFtDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChjcmlkLmVxdWFscygiU0wgVEFYIikpIHsNCiAgICAgICAgICAgICAgdGF4Q2hhcmdlID0gdGF4Q2hhcmdlICsgY3JhbQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgY2hyZyA9IGNocmcgKyBjcmFtDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIFN0cmluZyBjaHN0ID0gY29udGFpbmVyLmdldCgiT0VDSFNUIikudG9TdHJpbmcoKS50cmltKCkNCiAgICAgICAgICBpZiAoY3JpZC5zdGFydHNXaXRoKCJGUlQiKSAmJiAhY2hzdC5lcXVhbHMoIjkwIikpIHsNCiAgICAgICAgICAgIGZydCA9IGZydCArIGNyYW0NCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKCFjcmlkLnN0YXJ0c1dpdGgoIkZSVCIpICYmICFjaHN0LmVxdWFscygiOTAiKSkgew0KICAgICAgICAgICAgaWYgKGNyaWQuZXF1YWxzKCJTTCBUQVgiKSkgew0KICAgICAgICAgICAgICB0YXhDaGFyZ2UgPSB0YXhDaGFyZ2UgKyBjcmFtDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBjaHJnID0gY2hyZyArIGNyYW0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiT09DSFJHIikuaW5kZXgoIjEwIikuc2VsZWN0aW9uKCJPRUNSSUQiLCAiT0VDUkFNIiwgIk9FQ0hTVCIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9FQ09OTyIsIGlDT05PKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9FT1JOTyIsIG9ybm8pDQogICAgY29udGFpbmVyLnNldCgiT0VETElYIiwgZGxpeCBhcyBMb25nKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9FV0hMTyIsIHdobG8pDQogICAgcXVlcnkucmVhZEFsbChjb250YWluZXIsIDQsIG1heFBhZ2VTaXplLCByc1JlYWRPT0NIUkcpDQogIH0NCg0KICAvKioNCiAgICogUmV0cmlldmVzIHRoZSBkaXNjb3VudCBhbW91bnQgZm9yIGEgZ2l2ZW4gb3JkZXIgbnVtYmVyLg0KICAgKiBAcGFyYW0gb3JubyBUaGUgb3JkZXIgbnVtYmVyDQogICAqIEByZXR1cm4gVGhlIGRpc2NvdW50IGFtb3VudA0KICAgKi8NCiAgcHVibGljIGRvdWJsZSBydHZEaXNjb3VudChTdHJpbmcgb3Jubykgew0KICAgIGRvdWJsZSBkaXNjb3VudCA9IDAuMA0KDQogICAgQ2xvc3VyZSA8ID8gPiByc1JlYWRPT0xJQ0ggPSB7DQogICAgICBEQkNvbnRhaW5lciBjb250YWluZXIgLT4NCiAgICAgIFN0cmluZyBjcmlkID0gY29udGFpbmVyLmdldCgiTzdDUklEIikudG9TdHJpbmcoKS50cmltKCkNCiAgICAgIGlmIChjcmlkICE9IG51bGwpIHsNCiAgICAgICAgZG91YmxlIGNyYW0gPSBjb250YWluZXIuZ2V0KCJPN0NSQU0iKSBhcyBEb3VibGUNCiAgICAgICAgZGlzY291bnQgPSBkaXNjb3VudCArIGNyYW0NCiAgICAgIH0NCiAgICB9DQogICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiT09MSUNIIikuaW5kZXgoIjAwIikuc2VsZWN0aW9uKCJPN0NSSUQiLCAiTzdDUkFNIikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgY29udGFpbmVyLnNldCgiTzdDT05PIiwgaUNPTk8pDQogICAgY29udGFpbmVyLnNldCgiTzdPUk5PIiwgb3JubykNCiAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMiwgbWF4UGFnZVNpemUsIHJzUmVhZE9PTElDSCkNCg0KICAgIHJldHVybiBkaXNjb3VudA0KICB9DQoNCiAgLyoqDQogICAqIFJldHJpZXZlcyB0aGUgVkFUIGFtb3VudCBmb3IgYSBnaXZlbiBvcmRlciBudW1iZXIuDQogICAqIEBwYXJhbSBvcm5vIFRoZSBvcmRlciBudW1iZXINCiAgICogQHJldHVybiBUaGUgVkFUIGFtb3VudA0KICAgKi8NCiAgcHVibGljIGRvdWJsZSBydHZWYXRBbW91bnQoU3RyaW5nIG9ybm8pIHsNCiAgICBkb3VibGUgdmF0QW10ID0gMA0KICAgIE1hcCA8IFN0cmluZywgU3RyaW5nID4gcGFyYW1zID0gWyJDT05PIjogaUNPTk8udG9TdHJpbmcoKS50cmltKCksICJPUk5PIjogb3Jub10NCiAgICBDbG9zdXJlIDwgPyA+IGNhbGxiYWNrID0gew0KICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgIGlmIChyZXNwb25zZS5WVEFNICE9IG51bGwgJiYgcmVzcG9uc2UuSVZUQSAhPSBudWxsKSB7DQogICAgICAgIC8vR2V0IFZBVCBhbW91bnRzDQogICAgICAgIGRvdWJsZSByZXNwVlRBTSA9IDANCiAgICAgICAgU3RyaW5nIHN0clZUQU0gPSByZXNwb25zZS5WVEFNIGFzIFN0cmluZw0KICAgICAgICBpZiAoIXN0clZUQU0udHJpbSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIHJlc3BWVEFNID0gc3RyVlRBTSBhcyBEb3VibGUNCiAgICAgICAgfQ0KICAgICAgICBkb3VibGUgcmVzcElWVEEgPSAwDQogICAgICAgIFN0cmluZyBzdHJJVlRBID0gcmVzcG9uc2UuSVZUQSBhcyBTdHJpbmcNCiAgICAgICAgaWYgKCFzdHJJVlRBLnRyaW0oKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICByZXNwSVZUQSA9IHJlc3BvbnNlLklWVEEgYXMgRG91YmxlDQogICAgICAgIH0NCiAgICAgICAgdmF0QW10ID0gcmVzcFZUQU0gKyByZXNwSVZUQQ0KICAgICAgfQ0KICAgIH0NCiAgICBtaUNhbGxlci5jYWxsKCJPSVMxMDBNSSIsICJHZXRPcmRlclZhbHVlIiwgcGFyYW1zLCBjYWxsYmFjaykNCiAgICByZXR1cm4gdmF0QW10DQogIH0NCg0KfQ=="}}}