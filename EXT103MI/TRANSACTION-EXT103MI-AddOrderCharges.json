{"programModules":{"EXT103MI":{"program":"EXT103MI","triggers":{},"transactions":{"AddOrderCharges":{"sourceUuid":"e9994ff1-3fbf-402e-bd86-c15d6d5b5e55","name":"AddOrderCharges","program":"EXT103MI","description":"Add Order charges with data from GlobalShip","active":true,"multi":false,"modified":1697714792829,"modifiedBy":"M3CONSADMX","outputFields":[],"inputFields":[{"name":"CONO","description":"Company Number","length":3,"mandatory":false,"type":"N"},{"name":"ORNO","description":"Order Number","length":10,"mandatory":true,"type":"A"}],"utilities":[]}},"batches":{},"advancedPrograms":{}}},"utilities":{},"sources":{"e9994ff1-3fbf-402e-bd86-c15d6d5b5e55":{"uuid":"e9994ff1-3fbf-402e-bd86-c15d6d5b5e55","updated":1702540629115,"updatedBy":"ABHISHEK","created":1697691188831,"createdBy":"M3CONSADMX","apiVersion":"0.21","beVersion":"16.0.0.20230918173517.9","language":"GROOVY","codeHash":"35119345B459B128572D1AB904702C9BF4A06595D8676F3D7CD318395B68F46E","code":"LyoqDQogKiBSRUFETUUNCiAqIFRoaXMgZXh0ZW5zaW9uIGlzIGJlaW5nIHVzZWQgdG8gQWRkIG9yZGVyIGNoYXJnZXMgdG8gY3VzdG9tZXIgb3JkZXIgYmFzZWQgb24gZGF0YSBmcm9tIGdsb2JhbHNoaXANCiAqDQogKiBOYW1lOiBFWFQxMDNNSS5BZGRPcmRlckNoYXJnZXMNCiAqIERlc2NyaXB0aW9uOiBUcmFuc2FjdGlvbiB1c2VkIHRvIEFkZCBvcmRlciBjaGFyZ2VzIHRvIGN1c3RvbWVyIG9yZGVyIGJhc2VkIG9uIGRhdGEgZnJvbSBnbG9iYWxzaGlwDQogKiBEYXRlCSAgICAgIENoYW5nZWQgQnkgICAgICAgICAgICAgICAgICAgICAgRGVzY3JpcHRpb24NCiAqMjAyMzEwMTkgIFN1cml5YU5AZm9ydHVkZS5jbyAgICAgQWRkIG9yZGVyIGNoYXJnZXMgdG8gY3VzdG9tZXIgb3JkZXIgYmFzZWQgb24gZGF0YSBmcm9tIGdsb2JhbHNoaXAgKi8NCg0KaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwDQppbXBvcnQgamF2YS50aW1lLkxvY2FsRGF0ZQ0KaW1wb3J0IGphdmEudGltZS5EYXlPZldlZWsNCmltcG9ydCBqYXZhLnRpbWUuZm9ybWF0LkRhdGVUaW1lRm9ybWF0dGVyDQppbXBvcnQgZ3Jvb3Z5Lmpzb24uSnNvbkV4Y2VwdGlvbg0KaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyDQppbXBvcnQgb3JnLnczYy5kb20uRG9jdW1lbnQNCmltcG9ydCBvcmcudzNjLmRvbS5FbGVtZW50DQppbXBvcnQgb3JnLnczYy5kb20uTm9kZQ0KaW1wb3J0IG9yZy53M2MuZG9tLk5vZGVMaXN0DQppbXBvcnQgamF2YXgueG1sLnBhcnNlcnMuRG9jdW1lbnRCdWlsZGVyDQppbXBvcnQgamF2YXgueG1sLnBhcnNlcnMuRG9jdW1lbnRCdWlsZGVyRmFjdG9yeQ0KDQpwdWJsaWMgY2xhc3MgQWRkT3JkZXJDaGFyZ2VzIGV4dGVuZHMgRXh0ZW5kTTNUcmFuc2FjdGlvbiB7DQogIHByaXZhdGUgZmluYWwgTUlBUEkgbWkNCiAgcHJpdmF0ZSBmaW5hbCBNSUNhbGxlckFQSSBtaUNhbGxlcg0KICBwcml2YXRlIGZpbmFsIERhdGFiYXNlQVBJIGRhdGFiYXNlDQogIHByaXZhdGUgZmluYWwgUHJvZ3JhbUFQSSBwcm9ncmFtDQogIHByaXZhdGUgZmluYWwgSW9uQVBJIGlvbg0KICBwcml2YXRlIGZpbmFsIExvZ2dlckFQSSBsb2dnZXINCg0KICBwcml2YXRlIGludCBpQ09OTywgcGFnZVNpemU9MTAwMA0KICBwcml2YXRlIFN0cmluZyBpT1JOTywgVEVQWSwgc2hpcERhdGUsIGNvZGVGbGFnLCB1bmxvYWRpbmdab25lDQogIHByaXZhdGUgSGFzaE1hcCA8IFN0cmluZywgU3RyaW5nID4gd2FyZWhvdXNlcyA9IG5ldyBIYXNoTWFwIDwgU3RyaW5nLCBTdHJpbmcgPiAoKTsNCiAgcHJpdmF0ZSBib29sZWFuIHZhbGlkSW5wdXQgPSB0cnVlDQoNCiAgcHVibGljIEFkZE9yZGVyQ2hhcmdlcyhNSUFQSSBtaSwgTUlDYWxsZXJBUEkgbWlDYWxsZXIsIFByb2dyYW1BUEkgcHJvZ3JhbSwgSW9uQVBJIGlvbiwgTG9nZ2VyQVBJIGxvZ2dlciwgRGF0YWJhc2VBUEkgZGF0YWJhc2UpIHsNCiAgICB0aGlzLm1pID0gbWkNCiAgICB0aGlzLm1pQ2FsbGVyID0gbWlDYWxsZXINCiAgICB0aGlzLnByb2dyYW0gPSBwcm9ncmFtDQogICAgdGhpcy5pb24gPSBpb24NCiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcg0KICAgIHRoaXMuZGF0YWJhc2UgPSBkYXRhYmFzZQ0KICB9DQoNCiAgcHVibGljIHZvaWQgbWFpbigpIHsNCiAgICBpQ09OTyA9IChtaS5pbkRhdGEuZ2V0KCJDT05PIikgPT0gbnVsbCB8fCBtaS5pbkRhdGEuZ2V0KCJDT05PIikudHJpbSgpLmlzRW1wdHkoKSkgPyBwcm9ncmFtLkxEQVpELkNPTk8gYXMgSW50ZWdlciA6IG1pLmluRGF0YS5nZXQoIkNPTk8iKSBhcyBJbnRlZ2VyDQogICAgaU9STk8gPSAobWkuaW5EYXRhLmdldCgiT1JOTyIpID09IG51bGwgfHwgbWkuaW5EYXRhLmdldCgiT1JOTyIpLnRyaW0oKS5pc0VtcHR5KCkpID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJPUk5PIikNCg0KICAgIHZhbGlkYXRlSW5wdXQoKQ0KICAgIGlmICh2YWxpZElucHV0KSB7DQoNCiAgICAgIGdldFNoaXBEYXRlKCkNCiAgICAgIGdldFVubG9hZGluZ1pvbmUoKQ0KICAgICAgZ2V0QWxsV2FyZWhvdXNlcygpDQoNCiAgICAgIEl0ZXJhdG9yIDwgTWFwLkVudHJ5IDwgU3RyaW5nLCBTdHJpbmcgPj4gaXRlcmF0b3IgPSB3YXJlaG91c2VzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsNCiAgICAgIHdoaWxlIChpdGVyYXRvci5oYXNOZXh0KCkpIHsNCiAgICAgICAgTWFwLkVudHJ5IDwgU3RyaW5nLCBTdHJpbmcgPiBlbnRyeSA9IGl0ZXJhdG9yLm5leHQoKTsNCiAgICAgICAgU3RyaW5nIHdhcmVob3VzZSA9IGVudHJ5LmdldEtleSgpOw0KICAgICAgICBTdHJpbmcgZGVsaXZlcnlOdW1iZXIgPSBlbnRyeS5nZXRWYWx1ZSgpOw0KICAgICAgICBBZGRXYXJlaG91c2VDaGFyZ2VzKHdhcmVob3VzZSwgZGVsaXZlcnlOdW1iZXIpDQogICAgICB9DQogICAgfQ0KDQogIH0NCg0KICAvKioNCiAgICpWYWxpZGF0ZSBSZWNvcmRzDQogICAqIEBwYXJhbXMNCiAgICogQHJldHVybiANCiAgICovDQoNCiAgcHVibGljIHZhbGlkYXRlSW5wdXQoKSB7DQoNCiAgICAvL1ZhbGlkYXRlIENvbXBhbnkgTnVtYmVyDQogICAgTWFwPFN0cmluZywgU3RyaW5nPiBwYXJhbXMgPSBbIkNPTk8iOiBpQ09OTy50b1N0cmluZygpLnRyaW0oKV0NCiAgICBDbG9zdXJlPD8+IGNhbGxiYWNrID0gew0KICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgIGlmIChyZXNwb25zZS5DT05PID09IG51bGwpIHsNCiAgICAgICAgbWkuZXJyb3IoIkludmFsaWQgQ29tcGFueSBOdW1iZXIgIiArIGlDT05PKQ0KICAgICAgICB2YWxpZElucHV0ID0gZmFsc2UNCiAgICAgICAgcmV0dXJuIA0KICAgICAgfQ0KICAgIH0NCiAgICBtaUNhbGxlci5jYWxsKCJNTlMwOTVNSSIsICJHZXQiLCBwYXJhbXMsIGNhbGxiYWNrKQ0KDQogICAgLy9WYWxpZGF0ZSBPcmRlciBOdW1iZXINCg0KICAgcGFyYW1zID0gWyJPUk5PIjppT1JOTy50b1N0cmluZygpLnRyaW0oKV0NCiAgICBjYWxsYmFjayA9IHsNCiAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgIFN0cmluZyA+IHJlc3BvbnNlIC0+DQoNCiAgICAgIGlmIChyZXNwb25zZS5PUk5PID09IG51bGwpIHsNCiAgICAgICAgbWkuZXJyb3IoIkludmFsaWQgT3JkZXIgTnVtYmVyICIgKyBpT1JOTykNCiAgICAgICAgdmFsaWRJbnB1dCA9IGZhbHNlDQogICAgICAgIHJldHVybiANCiAgICAgIH0gZWxzZSB7DQogICAgICAgIFRFUFkgPSByZXNwb25zZS5URVBZDQogICAgICAgIGlmIChURVBZICE9IG51bGwgJiYgKFRFUFkudHJpbSgpLmVxdWFscygiMDAyIikgfHwgVEVQWS50cmltKCkuZXF1YWxzKCIwMDMiKSkpIHsNCiAgICAgICAgICBjb2RlRmxhZyA9ICJZIg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGNvZGVGbGFnID0gIk4iDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgbWlDYWxsZXIuY2FsbCgiT0lTMTAwTUkiLCAiR2V0T3JkZXJIZWFkIiwgcGFyYW1zLCBjYWxsYmFjaykNCg0KDQogIH0NCg0KICAvKioNCiAgICpHZXQgdW5sb2FkaW5nIHpvbmUgb2YgdGhlIG9yZGVyDQogICAqIEBwYXJhbXMNCiAgICogQHJldHVybg0KICAgKi8NCiAgcHVibGljIGdldFVubG9hZGluZ1pvbmUoKSB7DQogICAgTWFwPFN0cmluZywgU3RyaW5nPiBwYXJhbXMgPSBbIkNPTk8iOiBpQ09OTy50b1N0cmluZygpLnRyaW0oKSwgIk9STk8iOiBpT1JOTy50b1N0cmluZygpLnRyaW0oKSwgIkFEUlQiOiAiMSJdDQogICAgQ2xvc3VyZTw/PiBjYWxsYmFjayA9IHsNCiAgICAgIE1hcCA8IFN0cmluZywNCiAgICAgIFN0cmluZyA+IHJlc3BvbnNlIC0+DQogICAgICBpZiAocmVzcG9uc2UuVUxaTyAhPSBudWxsKSB7DQogICAgICAgIHVubG9hZGluZ1pvbmUgPSByZXNwb25zZS5VTFNPDQogICAgICB9DQogICAgfQ0KICAgIG1pQ2FsbGVyLmNhbGwoIk9JUzEwME1JIiwgIkdldEFkZHJlc3MiLCBwYXJhbXMsIGNhbGxiYWNrKQ0KICB9DQoNCiAgLyoqDQogICAqR2V0IGFsbCB1bmlxdWUgd2FyZWhvdXNlcyBvZiB0aGUgZGVsaXZlcnkNCiAgICogQHBhcmFtcw0KICAgKiBAcmV0dXJuDQogICAqLw0KICBwdWJsaWMgZ2V0QWxsV2FyZWhvdXNlcygpIHsNCiAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uID0gZGF0YWJhc2UuZ2V0RXhwcmVzc2lvbkZhY3RvcnkoIk1IRElTSCIpDQogICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uZXEoIk9RUklETiIsIGlPUk5PKQ0KICAgIERCQWN0aW9uIHF1ZXJ5ID0gZGF0YWJhc2UudGFibGUoIk1IRElTSCIpLnNlbGVjdGlvbigiT1FETElYIiwgIk9RV0hMTyIpLm1hdGNoaW5nKGV4cHJlc3Npb24pLmluZGV4KCIwMCIpLmJ1aWxkKCkNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgIGNvbnRhaW5lci5zZXQoIk9RQ09OTyIsIGlDT05PKQ0KICAgIHF1ZXJ5LnJlYWRBbGwoY29udGFpbmVyLCAxLCBwYWdlU2l6ZSwgcmVzdWx0c2V0KQ0KICB9DQoNCiAgQ2xvc3VyZSA8ID8gPiByZXN1bHRzZXQgPSB7DQogICAgREJDb250YWluZXIgY29udGFpbmVyIC0+DQogICAgU3RyaW5nIHdhcmVob3VzZSA9IGNvbnRhaW5lci5nZXQoIk9RV0hMTyIpDQogICAgU3RyaW5nIGRlbGl2ZXJ5TnVtYmVyID0gY29udGFpbmVyLmdldCgiT1FETElYIikNCiAgICBpZiAoIXdhcmVob3VzZXMuY29udGFpbnNLZXkod2FyZWhvdXNlKSkgew0KICAgICAgd2FyZWhvdXNlcy5wdXQod2FyZWhvdXNlLCBkZWxpdmVyeU51bWJlcikNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICpHZXRTaGlwRGF0ZQ0KICAgKiBAcGFyYW1zDQogICAqIEByZXR1cm4gDQogICAqLw0KICBwdWJsaWMgZ2V0U2hpcERhdGUoKSB7DQogICAgTG9jYWxEYXRlIHRvZGF5ID0gTG9jYWxEYXRlLm5vdygpOw0KICAgIC8vIENoZWNrIGlmIHRvZGF5IGlzIFNhdHVyZGF5IChEYXlPZldlZWsuU0FUVVJEQVkpDQogICAgaWYgKHRvZGF5LmdldERheU9mV2VlaygpID09IERheU9mV2Vlay5TQVRVUkRBWSkgew0KICAgICAgLy8gSWYgaXQncyBTYXR1cmRheSwgYWRqdXN0IHRvIHRoZSBwcmV2aW91cyBkYXkgKEZyaWRheSkNCiAgICAgIHRvZGF5ID0gdG9kYXkubWludXNEYXlzKDEpOw0KICAgIH0NCiAgICAvLyBGb3JtYXQgdGhlIGRhdGUgYXMgInl5eXktTU0tZGQiDQogICAgRGF0ZVRpbWVGb3JtYXR0ZXIgZm9ybWF0dGVyID0gRGF0ZVRpbWVGb3JtYXR0ZXIub2ZQYXR0ZXJuKCJ5eXl5LU1NLWRkIik7DQogICAgc2hpcERhdGUgPSB0b2RheS5mb3JtYXQoZm9ybWF0dGVyKTsNCiAgfQ0KDQogIC8qKg0KICAgKmdldFBhcmFtZXRlcg0KICAgKiBAcGFyYW1zIHNoaXB2aWENCiAgICogQHJldHVybiBwYXJhbWV0ZXINCiAgICovDQogIHB1YmxpYyBTdHJpbmcgZ2V0cGF5bWVudFR5cGUoc2hpcHZpYSkgew0KICAgIFN0cmluZyBwYXJhbWV0ZXIgPSAiIg0KICAgIERCQWN0aW9uIHF1ZXJ5ID0gZGF0YWJhc2UudGFibGUoIkNTWVRBQiIpLnNlbGVjdGlvbigiQ1RQQVJNIikuaW5kZXgoIjAwIikuYnVpbGQoKQ0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgY29udGFpbmVyLnNldCgiQ1RDT05PIiwgaUNPTk8pDQogICAgY29udGFpbmVyLnNldCgiQ1RESVZJIiwgIiIpDQogICAgY29udGFpbmVyLnNldCgiQ1RTVENPIiwgIk1PREwiKQ0KICAgIGNvbnRhaW5lci5zZXQoIkNUTE5DRCIsICJHQiIpDQogICAgY29udGFpbmVyLnNldCgiQ1RTVEtZIiwgc2hpcHZpYSkNCiAgICBpZiAocXVlcnkucmVhZChjb250YWluZXIpKSB7DQogICAgICBwYXJhbWV0ZXIgPSBjb250YWluZXIuZ2V0KCJDVFBBUk0iKS50b1N0cmluZygpDQogICAgfQ0KDQogICAgaWYgKHBhcmFtZXRlci50cmltKCkuZXF1YWxzKCIyIikpIHsNCiAgICAgIHJldHVybiAiQ09MTEVDVCINCiAgICB9IGVsc2UgaWYgKHBhcmFtZXRlci50cmltKCkuZXF1YWxzKCIzIikpIHsNCiAgICAgIHJldHVybiAiM1JEUEFSVFkiDQogICAgfSBlbHNlIGlmIChURVBZLnRyaW0oKS5lcXVhbHMoIjAwMiIpIHx8IFRFUFkudHJpbSgpLmVxdWFscygiMDAzIikpIHsNCiAgICAgIHJldHVybiAiQ09MTEVDVCINCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuICJQUkVQQUlEIg0KICAgIH0NCiAgfQ0KICANCiAgLyoqDQogICAqZ2V0U2F0dXJkYXlEZWxpdmVyeQ0KICAgKiBAcGFyYW1zIE1PREwNCiAgICogQHJldHVybiBzdHJpbmcNCiAgICovDQogIHB1YmxpYyBTdHJpbmcgZ2V0U2F0dXJkYXlEZWxpdmVyeShNT0RMKSB7DQogICAgLy9HZXQgU2F0dXJkYXkgRGVsaXZlcnkNCiAgICBTdHJpbmcgc2F0dXJkYXlEZWxpdmVyeSA9ICJOIg0KICAgIE1hcDxTdHJpbmcsIFN0cmluZz4gcGFyYW1zID0gWyJDT05PIjogaUNPTk8udG9TdHJpbmcoKS50cmltKCksIkRJVkkiOiIiLCAiVFJRRiI6ICIwIiwgIk1TVEQiOiAiRlJUVVRJTCIsICJNVlJTIjogIjEiLCAiQk1TRyI6ICJQUk9QRVJUWSIsICJJQk9CIjogIk8iLCAiRUxNUCI6ICJQUk9QRVJUWSIsICJFTE1EIjogIlByb3BlcnRpZXMiLCAiTVZYRCI6ICJTQVQiICsgTU9ETF0NCiAgICBDbG9zdXJlPD8+IGNhbGxiYWNrID0gew0KICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgIGlmIChyZXNwb25zZS5NQk1EICE9IG51bGwpIHsNCiAgICAgICAgc2F0dXJkYXlEZWxpdmVyeSA9ICJZIg0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2F0dXJkYXlEZWxpdmVyeSA9ICJOIg0KICAgICAgfQ0KICAgIH0NCiAgICBtaUNhbGxlci5jYWxsKCJDUlM4ODFNSSIsICJHZXRUcmFuc2xEYXRhIiwgcGFyYW1zLCBjYWxsYmFjaykNCiAgICAgcmV0dXJuIHNhdHVyZGF5RGVsaXZlcnkNCiAgfQ0KICANCiAgLyoqDQogICAqZ2V0Q2hhcmdlQ29kZQ0KICAgKiBAcGFyYW1zIFdITE8NCiAgICogQHJldHVybiBzdHJpbmcNCiAgICovDQogIHB1YmxpYyBTdHJpbmcgZ2V0Q2hhcmdlQ29kZShXSExPKSB7DQogICAgLy9HZXQgU2F0dXJkYXkgRGVsaXZlcnkNCiAgICBTdHJpbmcgY2hhcmdlQ29kZSA9ICIiDQogICAgTWFwPFN0cmluZywgU3RyaW5nPiBwYXJhbXMgPSBbIkNPTk8iOiBpQ09OTy50b1N0cmluZygpLnRyaW0oKSwiRElWSSI6IiIsICJUUlFGIjogIjAiLCAiTVNURCI6ICJGUlRVVElMIiwgIk1WUlMiOiAiMSIsICJCTVNHIjogIlBST1BFUlRZIiwgIklCT0IiOiAiTyIsICJFTE1QIjogIlBST1BFUlRZIiwgIkVMTUQiOiAiUHJvcGVydGllcyIsICJNVlhEIjogIkZSVCIgKyBXSExPXQ0KICAgIENsb3N1cmU8Pz4gY2FsbGJhY2sgPSB7DQogICAgICBNYXAgPCBTdHJpbmcsDQogICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgaWYgKHJlc3BvbnNlLk1CTUQgIT0gbnVsbCkgew0KICAgICAgIGNoYXJnZUNvZGUgPSByZXNwb25zZS5NQk1EDQogICAgICB9IA0KICAgIH0NCiAgICBtaUNhbGxlci5jYWxsKCJDUlM4ODFNSSIsICJHZXRUcmFuc2xEYXRhIiwgcGFyYW1zLCBjYWxsYmFjaykNCiAgICAgcmV0dXJuIGNoYXJnZUNvZGUNCiAgICANCiAgfQ0KDQogIC8qKg0KICAgKkFkZCBXYXJlaG91c2UgQ2hhcmdlcw0KICAgKiBAcGFyYW1zIHdhcmVob3VzZSwgZGVsaXZlcnlOdW1iZXINCiAgICogQHJldHVybg0KICAgKi8NCiAgcHVibGljIEFkZFdhcmVob3VzZUNoYXJnZXMoU3RyaW5nIHdhcmVob3VzZSxTdHJpbmcgZGVsaXZlcnlOdW1iZXIpIHsNCiAgICANCiAgICAvL0RlY2xhcmUgVmFyaWFibGVzDQogICAgU3RyaW5nIHNoaXB2aWEsIG5hbWUsIEFEUjEsIEFEUjIsIFRPV04sIEVDQVIsIFBPTk8sIENTQ0QsIE1PREwsIHNhdHVyZGF5RGVsaXZlcnksIHBheW1lbnRUeXBlLGNoYXJnZUNvZGUsIGNvbnRlbnRCb2R5ID0gIiINCiAgICBEb3VibGUgbnRhbSA9IDANCiAgICANCiAgICANCiAgICAvL0dldCBEZWxpdmVyeSBEZXRhaWxzDQogICAgTWFwPFN0cmluZywgU3RyaW5nPiBwYXJhbXMgPSBbIkNPTk8iOiBpQ09OTy50b1N0cmluZygpLnRyaW0oKSwgIkRMSVgiOiBkZWxpdmVyeU51bWJlci50b1N0cmluZygpLnRyaW0oKV0NCiAgICBDbG9zdXJlPD8+IGNhbGxiYWNrID0gew0KICAgICAgTWFwIDwgU3RyaW5nLA0KICAgICAgU3RyaW5nID4gcmVzcG9uc2UgLT4NCiAgICAgIE1PREwgPSByZXNwb25zZS5NT0RMDQogICAgICBzaGlwdmlhID0gcmVzcG9uc2UuTU9ERg0KICAgICAgaWYgKHNoaXB2aWEgPT0gbnVsbCB8fCBzaGlwdmlhLnRyaW0oKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2hpcHZpYSA9IE1PREwNCiAgICAgIH0NCiAgICB9DQogICAgbWlDYWxsZXIuY2FsbCgiTVdTNDEwTUkiLCAiR2V0SGVhZCIsIHBhcmFtcywgY2FsbGJhY2spDQogICAgDQogICAgDQogICAgcGF5bWVudFR5cGUgPSBnZXRwYXltZW50VHlwZShzaGlwdmlhKQ0KICAgIHNhdHVyZGF5RGVsaXZlcnkgPSBnZXRTYXR1cmRheURlbGl2ZXJ5KE1PREwpDQogICAgY2hhcmdlQ29kZSA9IGdldENoYXJnZUNvZGUod2FyZWhvdXNlKQ0KICAgIA0KICAgIC8vR2V0IEFkZHJlc3MgRGV0YWlscw0KICAgIHBhcmFtcyA9IFsiQ09OTyI6IGlDT05PLnRvU3RyaW5nKCkudHJpbSgpLCAiRExJWCI6IGRlbGl2ZXJ5TnVtYmVyLnRvU3RyaW5nKCkudHJpbSgpLCAiQURSVCI6ICIxMSJdDQogICAgY2FsbGJhY2sgPSB7DQogICAgICBNYXAgPCBTdHJpbmcsDQogICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgbmFtZSA9IHJlc3BvbnNlLk5BTUUNCiAgICAgIEFEUjEgPSByZXNwb25zZS5BRFIxDQogICAgICBBRFIyID0gcmVzcG9uc2UuQURSMg0KICAgICAgVE9XTiA9IHJlc3BvbnNlLlRPV04NCiAgICAgIEVDQVIgPSByZXNwb25zZS5FQ0FSDQogICAgICBQT05PID0gcmVzcG9uc2UuUE9OTw0KICAgICAgQ1NDRCA9IHJlc3BvbnNlLkNTQ0QNCiAgICB9DQogICAgbWlDYWxsZXIuY2FsbCgiTVdTNDEwTUkiLCAiR2V0QWRyIiwgcGFyYW1zLCBjYWxsYmFjaykNCg0KICAgIC8vTGlzdCBPcmRlciBMaW5lcyANCiAgICBwYXJhbXMgPSBbIkNPTk8iOiBpQ09OTy50b1N0cmluZygpLnRyaW0oKSwgIk9STk8iOiBpT1JOTy50cmltKCldDQogICAgY2FsbGJhY2sgPSB7DQogICAgICBNYXAgPCBTdHJpbmcsDQogICAgICBTdHJpbmcgPiByZXNwb25zZSAtPg0KICAgICAgU3RyaW5nIGFwaVdITE8gPSByZXNwb25zZS5XSExPDQogICAgICBpZiAoYXBpV0hMTyA9PSBudWxsKSBhcGlXSExPID0gIiINCiAgICAgIGlmIChhcGlXSExPLnRyaW0oKS5lcXVhbHMod2FyZWhvdXNlKSkgew0KICAgICAgICBjb250ZW50Qm9keSA9IGNvbnRlbnRCb2R5ICsgIjxjb250ZW50PlxuIiArDQogICAgICAgICAgIiAgIDxjb21tb2RpdHlpdGVtY29kZT4iICsgcmVzcG9uc2UuSVROTy50cmltKCkgKyAiPC9jb21tb2RpdHlpdGVtY29kZT5cbiIgKw0KICAgICAgICAgICIgICA8cXVhbnRpdHk+IiArIHJlc3BvbnNlLk9SUVQudHJpbSgpICsgIjwvcXVhbnRpdHk+XG4iICsNCiAgICAgICAgICAiPC9jb250ZW50PiINCiAgICAgICAgbnRhbSA9IG50YW0gKyBEb3VibGUucGFyc2VEb3VibGUocmVzcG9uc2UuTkxBTSkNCiAgICAgIH0NCiAgICB9DQogICAgbWlDYWxsZXIuY2FsbCgiT0lTMTAwTUkiLCAiTHN0TGluZSIsIHBhcmFtcywgY2FsbGJhY2spDQogICAgDQogICAgaWYoc2hpcHZpYT09bnVsbCkgc2hpcHZpYSA9ICIiDQogICAgaWYoY29kZUZsYWc9PW51bGwpIGNvZGVGbGFnID0gIiINCiAgICBpZih1bmxvYWRpbmdab25lPT1udWxsKSB1bmxvYWRpbmdab25lID0gIiINCiAgICBpZihzYXR1cmRheURlbGl2ZXJ5PT1udWxsKSBzYXR1cmRheURlbGl2ZXJ5ID0gIiINCiAgICBpZihuYW1lPT1udWxsKSBuYW1lID0gIiINCiAgICBpZihBRFIxPT1udWxsKSBBRFIxID0gIiINCiAgICBpZihBRFIyPT1udWxsKSBBRFIyID0gIiINCiAgICBpZihUT1dOPT1udWxsKSBUT1dOID0gIiINCiAgICBpZihFQ0FSPT1udWxsKSBFQ0FSID0gIiINCiAgICBpZihQT05PPT1udWxsKSBQT05PID0gIiINCiAgICBpZihDU0NEPT1udWxsKSBDU0NEID0gIiINCiAgICBpZihjb250ZW50Qm9keT09bnVsbCkgY29udGVudEJvZHkgPSAiIg0KICAgIGlmKGlPUk5PPT1udWxsKSBpT1JOTyA9ICIiDQogICAgDQogICAgU3RyaW5nIHhtbFN0cmluZyA9ICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJVVEYtOFwiPz5cbiIgKw0KICAgICAgIjxzaGlwbWVudD5cbiIgKw0KICAgICAgIiAgIDxoZWFkZXI+XG4iICsNCiAgICAgICIgICAgICA8c2hpcHBpbmdwcm9maWxlPiIgKyB3YXJlaG91c2UudHJpbSgpICsgIjwvc2hpcHBpbmdwcm9maWxlPlxuIiArDQogICAgICAiICAgICAgPG9yZGVybnVtYmVyPiIgKyBpT1JOTy50cmltKCkgKyAiPC9vcmRlcm51bWJlcj5cbiIgKw0KICAgICAgIiAgICAgIDxzaGlwdmlhPiIgKyBzaGlwdmlhLnRyaW0oKSArICI8L3NoaXB2aWE+XG4iICsNCiAgICAgICIgICAgICA8c2hpcGRhdGU+IiArIHNoaXBEYXRlLnRyaW0oKSArICI8L3NoaXBkYXRlPlxuIiArDQogICAgICAiICAgICAgPHNoaXBhY3Rpb24+UkFURTwvc2hpcGFjdGlvbj5cbiIgKw0KICAgICAgIiAgICAgIDxwYXltZW50dHlwZT5QUkVQQUlEPC9wYXltZW50dHlwZT5cbiIgKw0KICAgICAgIiAgICAgIDxjb2RmbGFnPiIgKyBjb2RlRmxhZy50cmltKCkgKyAiPC9jb2RmbGFnPlxuIiArDQogICAgICAiICAgICAgPGFkZHJlc3N0eXBlPiIgKyB1bmxvYWRpbmdab25lLnRyaW0oKSArICI8L2FkZHJlc3N0eXBlPlxuIiArDQogICAgICAiICAgICAgPHNhdHVyZGF5ZGVsaXZlcnk+IiArIHNhdHVyZGF5RGVsaXZlcnkudHJpbSgpICsgIjwvc2F0dXJkYXlkZWxpdmVyeT5cbiIgKw0KICAgICAgIiAgICAgIDxhZGRyZXNzIHR5cGU9XCJzaGlwdG9cIj5cbiIgKw0KICAgICAgIiAgICAgICAgIDxjb21wYW55PiIgKyBuYW1lLnRyaW0oKSArICI8L2NvbXBhbnk+XG4iICsNCiAgICAgICIgICAgICAgICA8YXR0ZW50aW9uPiIgKyBuYW1lLnRyaW0oKSArICI8L2F0dGVudGlvbj5cbiIgKw0KICAgICAgIiAgICAgICAgIDxhZGRyZXNzMT4iICsgQURSMS50cmltKCkgKyAiICIgKyBBRFIyLnRyaW0oKSArICI8L2FkZHJlc3MxPlxuIiArDQogICAgICAiICAgICAgICAgPGNpdHk+IiArIFRPV04udHJpbSgpICsgIjwvY2l0eT5cbiIgKw0KICAgICAgIiAgICAgICAgIDxzdGF0ZT4iICsgRUNBUi50cmltKCkgKyAiPC9zdGF0ZT5cbiIgKw0KICAgICAgIiAgICAgICAgIDx6aXBjb2RlPiIgKyBQT05PLnRyaW0oKSArICI8L3ppcGNvZGU+XG4iICsNCiAgICAgICIgICAgICAgICA8Y291bnRyeT4iICsgQ1NDRC50cmltKCkgKyAiPC9jb3VudHJ5PlxuIiArDQogICAgICAiICAgICAgPC9hZGRyZXNzPlxuIiArDQogICAgICAiICAgPC9oZWFkZXI+XG4iICsNCiAgICAgICIgICA8Y29udGVudHM+XG4iICsNCiAgICAgIGNvbnRlbnRCb2R5LnRyaW0oKSArICJcbiIgKw0KICAgICAgIiAgIDwvY29udGVudHM+XG4iICsNCiAgICAgICIgICA8ZGVjbGFyZWRWYWx1ZT4iICsgbnRhbSArICI8L2RlY2xhcmVkVmFsdWU+XG4iICsNCiAgICAgICIgICA8bG9hZHM+XG4iICsNCiAgICAgICIgICAgICA8bG9hZCBsb2FkaWQ9XCIiICsgaU9STk8udHJpbSgpICsgIlwiIGNvbnRhaW5lcnNlbGVjdGlvbnJ1bGU9XCIyXCIgLz5cbiIgKw0KICAgICAgIiAgIDwvbG9hZHM+XG4iICsNCiAgICAgICI8L3NoaXBtZW50PiINCg0KICAgIGRlZiBlbmRwb2ludCA9ICIvQ3VzdG9tZXJBcGkvR2xvYmFsU2hpcC9hcGkvYXBpL0xvZ2ljb3JJbnRlZ3JhdGlvbiINCiAgICBkZWYgaGVhZGVycyA9IFsiQWNjZXB0IjogImFwcGxpY2F0aW9uL3htbCIsICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24veG1sIl0NCiAgICBsb2dnZXIuZGVidWcoeG1sU3RyaW5nKQ0KICAgIGRlZiBxdWVyeVBhcmFtZXRlcnMgPSAoTWFwKSBudWxsIC8vIGRlZmluZSBhcyBtYXAgaWYgdGhlcmUgYXJlIGFueSBxdWVyeSBwYXJhbWV0ZXJzIGUuZy4gWyJuYW1lMSI6ICJ2YWx1ZTEiLCAibmFtZTIiOiAidmFsdWUyIl0NCiAgICBJb25SZXNwb25zZSByZXNwb25zZSA9IGlvbi5wb3N0KGVuZHBvaW50LCBoZWFkZXJzLCBxdWVyeVBhcmFtZXRlcnMsIHhtbFN0cmluZykNCiAgICBTdHJpbmcgY29udGVudCA9IHJlc3BvbnNlLmdldENvbnRlbnQoKQ0KICAgIGxvZ2dlci5kZWJ1ZygiQ09OVEVOVDogIiArIGNvbnRlbnQpDQogICAgaWYgKHJlc3BvbnNlLmdldEVycm9yKCkpIHsNCiAgICAgIG1pLmVycm9yKCJGYWlsZWQgY2FsbGluZyBJT04gQVBJLCBkZXRhaWxlZCBlcnJvciBtZXNzYWdlOiAke3Jlc3BvbnNlLmdldEVycm9yTWVzc2FnZSgpfSIpDQogICAgICByZXR1cm4NCiAgICB9DQogICAgaWYgKHJlc3BvbnNlLmdldFN0YXR1c0NvZGUoKSAhPSAyMDApIHsNCiAgICAgIG1pLmVycm9yKCJFeHBlY3RlZCBzdGF0dXMgMjAwIGJ1dCBnb3QgJHtyZXNwb25zZS5nZXRTdGF0dXNDb2RlKCl9IGluc3RlYWQiKQ0KICAgICAgcmV0dXJuDQogICAgfQ0KICAgIGlmIChjb250ZW50ID09IG51bGwpIHsNCiAgICAgbWkuZXJyb3IoIkV4cGVjdGVkIGNvbnRlbnQgZnJvbSB0aGUgcmVxdWVzdCBidXQgZ290IG5vIGNvbnRlbnQiKQ0KICAgICAgcmV0dXJuDQogICAgfQ0KICAgIA0KICAgIFN0cmluZyBzdGFydFRhZyA9ICImbHQ7c2hpcHJhdGUmZ3Q7IjsNCiAgICBTdHJpbmcgZW5kVGFnID0gImx0Oy9zaGlwcmF0ZSZndDsiOw0KICAgIGludCBzdGFydEluZGV4ID0gY29udGVudC5pbmRleE9mKHN0YXJ0VGFnKTsNCiAgICBpbnQgZW5kSW5kZXggPSBjb250ZW50LmluZGV4T2YoZW5kVGFnLCBzdGFydEluZGV4KTsNCiAgICBTdHJpbmcgc2hpcHJhdGVWYWx1ZSA9ICIwIg0KICAgIGlmIChzdGFydEluZGV4ICE9IC0xICYmIGVuZEluZGV4ICE9IC0xKSB7DQogICAgICAvLyBFeHRyYWN0IHRoZSB2YWx1ZSBiZXR3ZWVuIHRoZSBvcGVuaW5nIGFuZCBjbG9zaW5nIHRhZ3MNCiAgICAgIHNoaXByYXRlVmFsdWUgPSBjb250ZW50LnN1YnN0cmluZyhzdGFydEluZGV4ICsgc3RhcnRUYWcubGVuZ3RoKCksIGVuZEluZGV4LTEpOw0KICAgIH0gZWxzZSB7DQogICAgICBtaS5lcnJvcigiVW5hYmxlIHRvIGZldGNoIGNoYXJnZXMgZnJvbSBHbG9iYWxTaGlwIikNCiAgICAgIHJldHVybg0KICAgIH0NCiAgICBsb2dnZXIuZGVidWcoImNoYXJnZUNvZGU6ICIgK2NoYXJnZUNvZGUrIiBDUkFNOiAiK3NoaXByYXRlVmFsdWUpDQogICAvL0FkZCBPcmRlciBDaGFyZ2VzDQogICAgcGFyYW1zID0gWyJDT05PIjogaUNPTk8udG9TdHJpbmcoKS50cmltKCksICJPUk5PIjogaU9STk8udG9TdHJpbmcoKS50cmltKCksICJDUklEIjogY2hhcmdlQ29kZS50cmltKCksICJDUkFNIjogc2hpcHJhdGVWYWx1ZS50cmltKCldDQogICAgY2FsbGJhY2sgPSB7DQogICAgICBNYXAgPCBTdHJpbmcsDQogICAgICBTdHJpbmcgPiByZXNwb25zZTEgLT4NCiAgICAgIG1pLmVycm9yKCJFcnJvciBmcm9tIE9JUzEwMDogIityZXNwb25zZTEpDQogICAgfQ0KICAgIG1pQ2FsbGVyLmNhbGwoIk9JUzEwME1JIiwgIkFkZENvbm5DT0NoYXJnZSIsIHBhcmFtcywgY2FsbGJhY2spDQogIH0NCn0="}}}